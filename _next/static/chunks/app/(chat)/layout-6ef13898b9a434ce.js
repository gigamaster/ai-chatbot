(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7097],{2851:(e,s,t)=>{Promise.resolve().then(t.bind(t,28469))},28469:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>O});var n=t(98089),r=t(3224),l=t(39528),i=t.n(l),a=t(29501),d=t(39485),c=t(70469),o=t(61391),h=t(9511),x=t(64440),u=t(66700),j=t(65595),m=t(55928),p=t(59145),f=t(91502),v=t(74261);let g=(0,d.memo)(e=>{let{chat:s,isActive:r,onDelete:l,setOpenMobile:a}=e,d=async e=>{try{let n=await t.e(6487).then(t.bind(t,96487)),{getLocalMessagesByChatId:r}=await t.e(3415).then(t.bind(t,83415)),l=await r({id:s.id}),{convertToUIMessages:i}=await Promise.resolve().then(t.bind(t,53047)),a=i(l);"zip"===e?await n.exportChatAsZip(s,a):n.exportChat(s,a,e)}catch(e){console.error("Error exporting chat:",e)}};return(0,n.jsxs)(p.FX,{children:[(0,n.jsx)(p.Uj,{asChild:!0,isActive:r,children:(0,n.jsx)(i(),{href:"/chat-client?id=".concat(s.id),onClick:()=>a(!1),children:(0,n.jsx)("span",{children:s.title})})}),(0,n.jsxs)(v.rI,{modal:!0,children:[(0,n.jsx)(v.ty,{asChild:!0,children:(0,n.jsxs)(p.e7,{className:"mr-0.5 data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",showOnHover:!r,children:[(0,n.jsx)(o.jN,{}),(0,n.jsx)("span",{className:"sr-only",children:"More"})]})}),(0,n.jsxs)(v.SQ,{align:"end",side:"bottom",children:[(0,n.jsxs)(v.lv,{children:[(0,n.jsxs)(v.nV,{className:"cursor-pointer",children:[(0,n.jsx)(o.s3,{}),(0,n.jsx)("span",{children:"Download"})]}),(0,n.jsx)(v.dc,{children:(0,n.jsxs)(v.M5,{children:[(0,n.jsx)(v._2,{className:"cursor-pointer flex-row justify-between",onClick:()=>d("json"),children:(0,n.jsx)("div",{className:"flex flex-row items-center gap-2",children:(0,n.jsx)("span",{children:"JSON"})})}),(0,n.jsx)(v._2,{className:"cursor-pointer flex-row justify-between",onClick:()=>d("markdown"),children:(0,n.jsx)("div",{className:"flex flex-row items-center gap-2",children:(0,n.jsx)("span",{children:"Markdown"})})}),(0,n.jsx)(v._2,{className:"cursor-pointer flex-row justify-between",onClick:()=>d("text"),children:(0,n.jsx)("div",{className:"flex flex-row items-center gap-2",children:(0,n.jsx)("span",{children:"Plain Text"})})}),(0,n.jsx)(v._2,{className:"cursor-pointer flex-row justify-between",onClick:()=>d("zip"),children:(0,n.jsx)("div",{className:"flex flex-row items-center gap-2",children:(0,n.jsx)("span",{children:"ZIP Archive"})})})]})})]}),(0,n.jsxs)(v._2,{className:"cursor-pointer text-destructive focus:bg-destructive/15 focus:text-destructive dark:text-red-500",onSelect:()=>l(s.id),children:[(0,n.jsx)(o.uc,{}),(0,n.jsx)("span",{children:"Delete"})]})]})]})]})},(e,s)=>e.isActive===s.isActive);async function w(e){try{return await (0,f.W2)(e)}catch(e){return console.error("Error fetching chats from IndexedDB:",e),[]}}let b=e=>{let s=new Date,t=(0,h.k)(s,1),n=(0,x.a)(s,1);return e.reduce((e,s)=>{let r=new Date(s.createdAt);return(0,u.c)(r)?e.today.push(s):(0,j.P)(r)?e.yesterday.push(s):r>t?e.lastWeek.push(s):r>n?e.lastMonth.push(s):e.older.push(s),e},{today:[],yesterday:[],lastWeek:[],lastMonth:[],older:[]})};function y(e){let{user:s}=e,{setOpenMobile:r}=(0,p.cL)(),l=(0,a.useParams)(),i=(0,a.useRouter)(),[o,h]=(0,d.useState)(null);(0,d.useEffect)(()=>{if(l instanceof Promise)l.then(e=>{let s=null==e?void 0:e.id;h(Array.isArray(s)?s[0]||null:s||null)});else{let e=null==l?void 0:l.id;h(Array.isArray(e)?e[0]||null:e||null)}},[l]);let[x,u]=(0,d.useState)([]),[j,f]=(0,d.useState)(!0),[v,y]=(0,d.useState)(!1),[N,k]=(0,d.useState)(null),[C,A]=(0,d.useState)(!1),S=(0,d.useCallback)(async()=>{if(s){y(!0);try{await new Promise(e=>setTimeout(e,50));let e=await w(s.id);u(e)}catch(e){}finally{f(!1),y(!1)}}},[s]);(0,d.useEffect)(()=>{S();let e=()=>{S()},s=()=>{S()};return window.addEventListener("chatSaved",e),window.addEventListener("chatHistoryUpdated",s),()=>{window.removeEventListener("chatSaved",e),window.removeEventListener("chatHistoryUpdated",s)}},[S]);let D=async()=>{if(N){try{let{clientDbService:e}=await t.e(4232).then(t.bind(t,14232));await e.deleteChat(N),window.dispatchEvent(new CustomEvent("chatHistoryUpdated")),c.o.success("Chat deleted successfully")}catch(e){console.error("Error deleting chat:",e),c.o.error("Failed to delete chat")}A(!1),N===o&&i.push("/")}};if(!s)return(0,n.jsx)(p.Cn,{children:(0,n.jsx)(p.rQ,{children:(0,n.jsx)("div",{className:"flex w-full flex-row items-center justify-center gap-2 px-2 text-sm text-zinc-500",children:"Login to save and revisit previous chats!"})})});if(j)return(0,n.jsxs)(p.Cn,{children:[(0,n.jsx)("div",{className:"px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Today"}),(0,n.jsx)(p.rQ,{children:(0,n.jsx)("div",{className:"flex flex-col",children:[44,32,28,64,52].map(e=>(0,n.jsx)("div",{className:"flex h-8 items-center gap-2 rounded-md px-2",children:(0,n.jsx)("div",{className:"h-4 max-w-(--skeleton-width) flex-1 rounded-md bg-sidebar-accent-foreground/10",style:{"--skeleton-width":"".concat(e,"%")}})},e))})})]});if(0===x.length)return(0,n.jsx)(p.Cn,{children:(0,n.jsx)(p.rQ,{children:(0,n.jsx)("div",{className:"flex w-full flex-row items-center justify-center gap-2 px-2 text-sm text-zinc-500",children:"Your conversations will appear here once you start chatting!"})})});let E=b(x);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.Cn,{children:(0,n.jsx)(p.rQ,{children:(0,n.jsx)(p.wZ,{children:(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[E.today.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Today"}),E.today.map(e=>(0,n.jsx)(g,{chat:e,isActive:e.id===o,onDelete:e=>{k(e),A(!0)},setOpenMobile:r},e.id))]}),E.yesterday.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Yesterday"}),E.yesterday.map(e=>(0,n.jsx)(g,{chat:e,isActive:e.id===o,onDelete:e=>{k(e),A(!0)},setOpenMobile:r},e.id))]}),E.lastWeek.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Previous 7 Days"}),E.lastWeek.map(e=>(0,n.jsx)(g,{chat:e,isActive:e.id===o,onDelete:e=>{k(e),A(!0)},setOpenMobile:r},e.id))]}),E.lastMonth.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Previous 30 Days"}),E.lastMonth.map(e=>(0,n.jsx)(g,{chat:e,isActive:e.id===o,onDelete:e=>{k(e),A(!0)},setOpenMobile:r},e.id))]}),E.older.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Older"}),E.older.map(e=>(0,n.jsx)(g,{chat:e,isActive:e.id===o,onDelete:e=>{k(e),A(!0)},setOpenMobile:r},e.id))]})]})})})}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("button",{className:"px-3 py-2 text-center",disabled:v,onClick:S,type:"button",children:v?"Refreshing...":"Refresh"})}),C&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,n.jsxs)("div",{className:"w-96 rounded-lg bg-background p-6",children:[(0,n.jsx)("h3",{className:"mb-2 font-semibold text-lg",children:"Are you absolutely sure?"}),(0,n.jsx)("p",{className:"mb-4 text-muted-foreground text-sm",children:"This action cannot be undone. This will permanently delete your chat."}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(m.$,{onClick:()=>A(!1),variant:"outline",children:"Cancel"}),(0,n.jsx)(m.$,{onClick:D,variant:"destructive",children:"Delete"})]})]})})]})}var N=t(42496),k=t(93510),C=t(28021),A=t(12796);function S(e){let{email:s}=e,t=s?s.charAt(0).toUpperCase():"U";return(0,n.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-r from-blue-500 to-indigo-600",children:(0,n.jsx)("span",{className:"font-medium text-white text-xs",children:t})})}function D(e){let{user:s}=e,t=(0,a.useRouter)(),{user:r,logout:l}=(0,C.N)(),{setTheme:i,resolvedTheme:d}=(0,k.D)(),{lockTime:c,setLockTime:h,availableLockTimes:x,lock:u}=(0,A.V)();return(0,n.jsx)(p.wZ,{children:(0,n.jsx)(p.FX,{children:(0,n.jsxs)(v.rI,{children:[(0,n.jsx)(v.ty,{asChild:!0,children:void 0===r?(0,n.jsxs)(p.Uj,{className:"h-10 justify-between bg-background data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",children:[(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)("div",{className:"size-6 animate-pulse rounded-full bg-zinc-500/30"}),(0,n.jsx)("span",{className:"animate-pulse rounded-md bg-zinc-500/30",children:"Loading auth status"})]}),(0,n.jsx)("div",{className:"animate-spin text-zinc-500",children:(0,n.jsx)(o.hz,{})})]}):(0,n.jsxs)(p.Uj,{className:"h-10 bg-background data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground","data-testid":"user-nav-button",children:[(0,n.jsx)(S,{email:null==r?void 0:r.email}),(0,n.jsx)("span",{className:"truncate","data-testid":"user-email",children:null==r?void 0:r.email}),(0,n.jsx)(N.A,{className:"ml-auto"})]})}),(0,n.jsxs)(v.SQ,{className:"w-(--radix-popper-anchor-width)","data-testid":"user-nav-menu",side:"top",children:[(0,n.jsx)(v._2,{className:"cursor-pointer","data-testid":"user-nav-item-theme",onSelect:()=>i("dark"===d?"light":"dark"),children:"Toggle ".concat("light"===d?"dark":"light"," mode")}),(0,n.jsx)(v.mB,{}),(0,n.jsxs)(v.lv,{children:[(0,n.jsx)(v.nV,{className:"cursor-pointer",children:"Auto-lock Settings"}),(0,n.jsx)(v.M5,{children:(0,n.jsx)(v.Hr,{onValueChange:e=>{h("null"===e?null:Number.parseInt(e,10))},value:(null==c?void 0:c.toString())||"null",children:x.map(e=>{var s,t;return(0,n.jsx)(v.Ht,{value:(null==(s=e.value)?void 0:s.toString())||"null",children:e.label},(null==(t=e.value)?void 0:t.toString())||"null")})})})]}),(0,n.jsx)(v.mB,{}),(0,n.jsx)(v._2,{className:"cursor-pointer",onClick:()=>t.push("/settings"),children:"Settings"}),(0,n.jsx)(v.mB,{}),(0,n.jsx)(v._2,{className:"cursor-pointer",onClick:()=>u(),children:"Lock Now"}),(0,n.jsx)(v.mB,{}),(0,n.jsx)(v._2,{asChild:!0,"data-testid":"user-nav-item-auth",children:(0,n.jsx)("button",{className:"w-full cursor-pointer",onClick:()=>{l(),t.push("/")},type:"button",children:"Sign out"})})]})]})})})}var E=t(25159),_=t(23625);function M(e){let{user:s}=e,r=(0,a.useRouter)(),{setOpenMobile:l}=(0,p.cL)(),[h,x]=(0,d.useState)(!1),{user:u}=(0,C.N)(),j=void 0!==s?s:u,f=async()=>{if(j)try{let{clientHistoryService:e}=await t.e(9390).then(t.bind(t,9390));await e.deleteAllChats(j),await new Promise(e=>setTimeout(e,100)),window.dispatchEvent(new CustomEvent("chatHistoryUpdated")),r.push("/"),x(!1),c.o.success("All chats deleted successfully")}catch(e){c.o.error("Failed to delete all chats")}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(p.Bx,{className:"group-data-[side=left]:border-r-0",children:[(0,n.jsx)(p.Gh,{children:(0,n.jsx)(p.wZ,{children:(0,n.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,n.jsx)(i(),{className:"flex flex-row items-center gap-3",href:"/",onClick:()=>{l(!1)},children:(0,n.jsx)("span",{className:"cursor-pointer rounded-md px-2 font-semibold text-lg hover:bg-muted",children:"AI Chatbot"})}),(0,n.jsxs)("div",{className:"flex flex-row gap-1",children:[j&&(0,n.jsxs)(_.m_,{children:[(0,n.jsx)(_.k$,{asChild:!0,children:(0,n.jsx)(m.$,{className:"h-8 cursor-pointer p-1 text-destructive focus:bg-destructive/15 focus:text-destructive md:h-fit md:p-2 dark:text-red-500",onClick:()=>x(!0),type:"button",variant:"ghost",children:(0,n.jsx)(o.uc,{})})}),(0,n.jsx)(_.ZI,{align:"end",className:"hidden md:block",children:"Delete All Chats"})]}),(0,n.jsxs)(_.m_,{children:[(0,n.jsx)(_.k$,{asChild:!0,children:(0,n.jsx)(m.$,{className:"h-8 cursor-pointer p-1 md:h-fit md:p-2",onClick:()=>{l(!1),r.push("/"),r.refresh()},type:"button",variant:"ghost",children:(0,n.jsx)(o.c1,{})})}),(0,n.jsx)(_.ZI,{align:"end",className:"hidden md:block",children:"New Chat"})]})]})]})})}),(0,n.jsx)(p.Yv,{children:(0,n.jsx)(y,{user:j})}),(0,n.jsx)(p.CG,{children:j&&(0,n.jsx)(D,{user:j})})]}),(0,n.jsx)(E.Lt,{onOpenChange:x,open:h,children:(0,n.jsxs)(E.EO,{children:[(0,n.jsxs)(E.wd,{children:[(0,n.jsx)(E.r7,{children:"Delete all chats?"}),(0,n.jsx)(E.$v,{children:"This action cannot be undone. This will permanently delete all your chats and remove them from our servers."})]}),(0,n.jsxs)(E.ck,{children:[(0,n.jsx)(E.Zr,{children:"Cancel"}),(0,n.jsx)(E.Rx,{onClick:f,children:"Delete All"})]})]})})]})}function O(e){let{children:s}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.default,{src:"https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js",strategy:"beforeInteractive"}),(0,n.jsxs)(p.GB,{children:[(0,n.jsx)(M,{}),(0,n.jsx)(p.sF,{children:s})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[9200,7852,1495,782,152,5644,1017,9268,2174,8539,3958,7358],()=>s(2851)),_N_E=e.O()}]);