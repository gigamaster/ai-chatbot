"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4480],{18755:(e,t,s)=>{s.d(t,{UT:()=>a,jq:()=>n});let n="gemini-2.5-flash",r=[{id:"gpt-4o",name:"GPT-4o",description:"Most capable OpenAI model for chat and image understanding",provider:"openai",contextLength:128e3},{id:"claude-3-opus-20240229",name:"Claude 3 Opus",description:"Most powerful Anthropic model for complex tasks",provider:"anthropic",contextLength:2e5},{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash",description:"Google's free tier multimodal model with high performance",provider:"google",contextLength:1e6},{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro",description:"Google's advanced multimodal model",provider:"google",contextLength:1e6},{id:"mistral-large-latest",name:"Mistral Large",description:"Mistral AI's most capable model",provider:"mistral",contextLength:32e3}];function a(e){return r.find(t=>t.id===e)}},19564:(e,t,s)=>{s.d(t,{Z:()=>J});var n=s(98089),r=s(68693),a=s.n(r),i=s(39485),o=s(70469),l=s(36177),d=s(12857),c=s(53047),u=s(74261),m=s(81143);let p=i.forwardRef((e,t)=>{let{className:s,value:r,...a}=e;return(0,n.jsx)(m.Root,{ref:t,className:(0,c.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:(0,n.jsx)(m.Indicator,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});p.displayName=m.Root.displayName;var f=s(18755);let h=e=>{let{percent:t}=e,s=2*Math.PI*10,r=s*(1-t/100);return(0,n.jsxs)("svg",{"aria-label":"".concat(t.toFixed(2),"% of model context used"),height:"28",role:"img",style:{color:"currentcolor"},viewBox:"0 0 ".concat(24," ").concat(24),width:"28",children:[(0,n.jsx)("circle",{cx:12,cy:12,fill:"none",opacity:"0.25",r:10,stroke:"currentColor",strokeWidth:2}),(0,n.jsx)("circle",{cx:12,cy:12,fill:"none",opacity:"0.7",r:10,stroke:"currentColor",strokeDasharray:"".concat(s," ").concat(s),strokeDashoffset:r,strokeLinecap:"round",strokeWidth:2,transform:"rotate(-90 ".concat(12," ").concat(12,")")})]})};function g(e){let{label:t,tokens:s,costText:r}=e;return(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:t}),(0,n.jsxs)("div",{className:"flex items-center gap-2 font-mono",children:[(0,n.jsx)("span",{className:"min-w-[4ch] text-right",children:void 0===s?"â€”":s.toLocaleString()}),null!=r&&!Number.isNaN(Number.parseFloat(r))&&(0,n.jsxs)("span",{className:"text-muted-foreground",children:["$",Number.parseFloat(r).toFixed(6)]})]})]})}let x=e=>{var t;let{className:s,usage:r,...a}=e,i=null!=(t=null==r?void 0:r.totalTokens)?t:0,o=(null==r?void 0:r.modelId)?(0,f.UT)(r.modelId):void 0,l=null==o?void 0:o.contextLength,d="number"==typeof l&&Number.isFinite(l)&&l>0,m=d?Math.min(100,i/l*100):0;return(0,n.jsxs)(u.rI,{children:[(0,n.jsx)(u.ty,{asChild:!0,children:(0,n.jsxs)("button",{className:(0,c.cn)("inline-flex select-none items-center gap-1 rounded-md text-sm","cursor-pointer bg-background text-foreground",s),type:"button",...a,children:[(0,n.jsxs)("span",{className:"font-medium text-muted-foreground",children:[m.toFixed(1),"%"]}),(0,n.jsx)(h,{percent:m})]})}),(0,n.jsx)(u.SQ,{align:"end",className:"w-fit p-3",side:"top",children:(0,n.jsxs)("div",{className:"min-w-[240px] space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between text-sm",children:[(0,n.jsxs)("span",{children:[m.toFixed(1),"%"]}),(0,n.jsx)("span",{className:"text-muted-foreground",children:d?"".concat(i," / ").concat(l," tokens"):"".concat(i," tokens")})]}),(0,n.jsx)("div",{className:"space-y-2",children:(0,n.jsx)(p,{className:"h-2 bg-muted",value:m})}),(0,n.jsxs)("div",{className:"mt-1 space-y-1",children:[(0,n.jsx)(g,{label:"Input",tokens:null==r?void 0:r.inputTokens}),(0,n.jsx)(g,{label:"Output",tokens:null==r?void 0:r.outputTokens})]})]})})]})};var v=s(2257),y=s(66135),b=s(28268),j=s(7305),w=s(55928),k=s(38208),N=s(59197),C=s(42496),S=s(85409);let I=k.Root;k.Group;let T=k.Value,z=i.forwardRef((e,t)=>{let{className:s,children:r,...a}=e;return(0,n.jsxs)(k.Trigger,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[r,(0,n.jsx)(k.Icon,{asChild:!0,children:(0,n.jsx)(N.A,{className:"h-4 w-4 opacity-50"})})]})});z.displayName=k.Trigger.displayName;let E=i.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(k.ScrollUpButton,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,n.jsx)(C.A,{className:"h-4 w-4"})})});E.displayName=k.ScrollUpButton.displayName;let P=i.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(k.ScrollDownButton,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,n.jsx)(N.A,{className:"h-4 w-4"})})});P.displayName=k.ScrollDownButton.displayName;let M=i.forwardRef((e,t)=>{let{className:s,children:r,position:a="popper",...i}=e;return(0,n.jsx)(k.Portal,{children:(0,n.jsxs)(k.Content,{ref:t,className:(0,c.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...i,children:[(0,n.jsx)(E,{}),(0,n.jsx)(k.Viewport,{className:(0,c.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,n.jsx)(P,{})]})})});M.displayName=k.Content.displayName,i.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(k.Label,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=k.Label.displayName;let A=i.forwardRef((e,t)=>{let{className:s,children:r,...a}=e;return(0,n.jsxs)(k.Item,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(k.ItemIndicator,{children:(0,n.jsx)(S.A,{className:"h-4 w-4"})})}),(0,n.jsx)(k.ItemText,{children:r})]})});A.displayName=k.Item.displayName,i.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(k.Separator,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=k.Separator.displayName;var R=s(54506);let D=e=>{let{className:t,...s}=e;return(0,n.jsx)("form",{className:(0,c.cn)("w-full overflow-hidden rounded-xl border bg-background shadow-xs",t),...s})},_=e=>{let{onChange:t,className:s,placeholder:r="What would you like to know?",minHeight:a=48,maxHeight:i=164,disableAutoResize:o=!1,resizeOnNewLinesOnly:l=!1,...d}=e;return(0,n.jsx)(R.T,{className:(0,c.cn)("w-full resize-none rounded-none border-none p-3 shadow-none outline-hidden ring-0",o||l?"field-sizing-fixed":"field-sizing-content max-h-[6lh]","bg-transparent dark:bg-transparent","focus-visible:ring-0",s),name:"message",onChange:e=>{null==t||t(e)},onKeyDown:e=>{if("Enter"===e.key){if(e.nativeEvent.isComposing||e.shiftKey)return;e.preventDefault();let t=e.currentTarget.form;t&&t.requestSubmit()}},placeholder:r,...d})},V=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,c.cn)("flex items-center justify-between p-1",t),...s})},L=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,c.cn)("flex items-center gap-1","[&_button:first-child]:rounded-bl-xl",t),...s})},F=e=>{let{className:t,variant:s="default",size:r="icon",status:a,children:i,...o}=e,l=(0,n.jsx)(v.A,{className:"size-4"});return"submitted"===a?l=(0,n.jsx)(y.A,{className:"size-4 animate-spin"}):"streaming"===a?l=(0,n.jsx)(b.A,{className:"size-4"}):"error"===a&&(l=(0,n.jsx)(j.A,{className:"size-4"})),(0,n.jsx)(w.$,{className:(0,c.cn)("gap-1.5 rounded-lg",t),size:r,type:"submit",variant:s,...o,children:null!=i?i:l})};var O=s(61391),U=s(66581),q=s(15443);function H(e){let{value:t,onValueChange:s,placeholder:r="Select provider model",disabled:a=!1}=e,[l,c]=(0,i.useState)([]),[u,m]=(0,i.useState)(!0),[p,f]=(0,i.useState)(!1),h=(0,i.useCallback)(async()=>{try{m(!0);let e=await (0,d.SM)();c(e)}catch(e){console.error("Failed to load provider models:",e),o.o.error("Failed to load provider models")}finally{m(!1)}},[]);(0,i.useEffect)(()=>{h()},[h]);let g=async()=>{f(!0),await h(),f(!1)},x=l.find(e=>e.providerId===t);return u?(0,n.jsx)("div",{className:"flex h-10 items-center gap-2 rounded-md border border-input bg-background px-3 py-2",children:(0,n.jsx)("div",{className:"h-4 w-32 animate-pulse rounded bg-muted"})}):(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)(I,{disabled:a||0===l.length,onValueChange:e=>{let t=l.find(t=>t.providerId===e);t&&(null==s||s(t.providerId,t.modelName))},value:(null==x?void 0:x.providerId)||"",children:[(0,n.jsx)(z,{className:"w-full",children:(0,n.jsx)(T,{placeholder:r,children:x?x.name:r})}),(0,n.jsx)(M,{children:0===l.length?(0,n.jsx)(A,{disabled:!0,value:"__empty__",children:"No providers configured"}):l.map(e=>(0,n.jsx)(A,{value:e.providerId,children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{children:e.name}),(0,n.jsx)("span",{className:"text-muted-foreground text-xs",children:e.providerName})]})},e.id))})]}),(0,n.jsx)(w.$,{disabled:p,onClick:g,size:"icon",variant:"outline",children:(0,n.jsx)(q.A,{className:"h-4 w-4 ".concat(p?"animate-spin":"")})})]})}var W=s(72153),B=s(79432);i.forwardRef((e,t)=>{let{className:s,children:r,...a}=e;return(0,n.jsxs)(B.Root,{ref:t,className:(0,c.cn)("relative overflow-hidden",s),...a,children:[(0,n.jsx)(B.Viewport,{className:"h-full w-full rounded-[inherit]",children:r}),(0,n.jsx)($,{}),(0,n.jsx)(B.Corner,{})]})}).displayName=B.Root.displayName;let $=i.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...a}=e;return(0,n.jsx)(B.ScrollAreaScrollbar,{ref:t,orientation:r,className:(0,c.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...a,children:(0,n.jsx)(B.ScrollAreaThumb,{className:"relative flex-1 rounded-full bg-border"})})});$.displayName=B.ScrollAreaScrollbar.displayName;let K=e=>{let{suggestion:t,onClick:s,className:r,variant:a="outline",size:i="sm",children:o,...l}=e;return(0,n.jsx)(w.$,{className:(0,c.cn)("cursor-pointer rounded-lg px-4",r),onClick:()=>{null==s||s(t)},size:i,type:"button",variant:a,...l,children:o||t})},Z=(0,i.memo)(function(e){let{chatId:t,sendMessage:s,setInput:r}=e;return(0,n.jsx)("div",{className:"grid w-full gap-2 sm:grid-cols-2","data-testid":"suggested-actions",children:["Write a polite email to my manager about a deadline extension","Summarize the key differences between Node.js and Python","Help me brainstorm ideas for a blog post about productivity","Explain the concept of 'Cloud Computing' in simple terms"].map((e,s)=>(0,n.jsx)(W.P.div,{animate:{opacity:1,y:0},exit:{opacity:0,y:20},initial:{opacity:0,y:20},transition:{delay:.05*s},children:(0,n.jsx)(K,{className:"h-auto w-full whitespace-normal p-3 text-left",onClick:e=>{r&&r(e),window.history.replaceState({},"","/chat/".concat(t))},suggestion:e,children:e})},e))})},(e,t)=>e.chatId===t.chatId),J=(0,i.memo)(function(e){let{chatId:t,input:s,setInput:r,status:a,stop:u,attachments:m,setAttachments:p,messages:f,setMessages:h,sendMessage:g,className:v,selectedModelId:y,selectedProviderId:b,onModelChange:j,usage:w}=e,k=(0,i.useRef)(null),{width:N}=(0,l.lW)(),C=(0,i.useCallback)(()=>{k.current&&(k.current.style.height="44px")},[]);(0,i.useEffect)(()=>{k.current&&C()},[C]);let S=(0,i.useCallback)(()=>{k.current&&(k.current.style.height="44px")},[]),[I,T]=(0,l.Mj)("input","");(0,i.useEffect)(()=>{k.current&&(r(k.current.value||I||""),C())},[C,I,r]),(0,i.useEffect)(()=>{T(s)},[s,T]);let z=(0,i.useRef)(null),[E,P]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=async e=>{let t=e.target;if(t.files&&t.files.length>0){let e=Array.from(t.files);P(e.map(e=>e.name));try{for(let t of e)if("image/jpeg"===t.type||"image/png"===t.type){let e=new FileReader,s=await new Promise((s,n)=>{e.onload=e=>{var t;return s(null==(t=e.target)?void 0:t.result)},e.onerror=n,e.readAsDataURL(t)});p(e=>[...e,{url:s,name:t.name,contentType:t.type}])}}catch(e){console.error("Error processing files:",e),o.o.error("Failed to process file attachments")}finally{P([]),z.current&&(z.current.value="")}}},t=z.current;if(t)return t.addEventListener("change",e),()=>{t.removeEventListener("change",e)}},[p]);let M=(0,i.useCallback)(async()=>{if(!y)return void o.o.error("Please select a model before sending a message");if(!s.trim())return void o.o.error("Please enter a message before sending");let e=await (0,d.getAllProviders)(),n=null;if(b&&(n=e.find(e=>e.id===b)),!n){let t=e.filter(e=>e.model===y);if(0===t.length)return void o.o.error("Selected model not found. Please check your provider configuration.");n=t[0]}if(!n)return void o.o.error("No provider configured for the selected model. Please check your provider settings.");if(!n.apiKey)return void o.o.error("Provider API key is missing. Please check your provider configuration.");if(!n.baseUrl)return void o.o.error("Provider base URL is missing. Please check your provider configuration.");window.history.replaceState({},"","/chat/".concat(t));let a=[];for(let e of m)("image/jpeg"===e.contentType||"image/png"===e.contentType)&&a.push({type:"file",mediaType:e.contentType,name:e.name,url:e.url});if(a.push({type:"text",text:s}),g({role:"user",parts:a,providerId:null==n?void 0:n.id},{selectedProviderId:null==n?void 0:n.id,selectedModelId:y}),p([]),T(""),S(),r(""),N&&N>768){var i;null==(i=k.current)||i.focus()}},[s,r,m,g,p,T,N,t,S,y,b]);(0,i.useMemo)(()=>({id:y,languageModel:()=>y}),[y]);let A=(0,i.useMemo)(()=>({usage:w}),[w]);return(0,n.jsxs)("div",{className:(0,c.cn)("relative flex w-full flex-col gap-4",v),children:[(0,n.jsx)("input",{accept:"image/jpeg,image/png",className:"hidden",multiple:!0,ref:z,type:"file"}),0===f.length&&0===m.length&&0===E.length&&(0,n.jsx)(Z,{chatId:t,sendMessage:g,setInput:r}),(0,n.jsxs)(D,{className:"rounded-xl border border-border bg-background p-3 shadow-xs transition-all duration-200 focus-within:border-border hover:border-muted-foreground/50",onSubmit:e=>{e.preventDefault(),"idle"!==a&&"error"!==a?o.o.error("Please wait for the model to finish its response!"):M()},children:[(m.length>0||E.length>0)&&(0,n.jsxs)("div",{className:"flex flex-row items-end gap-2 overflow-x-scroll","data-testid":"attachments-preview",children:[m.map(e=>(0,n.jsx)(U.q,{attachment:e,onRemove:()=>{p(t=>t.filter(t=>t.url!==e.url)),z.current&&(z.current.value="")}},e.url)),E.map(e=>(0,n.jsx)(U.q,{attachment:{url:"",name:e,contentType:""},isUploading:!0},e))]}),(0,n.jsxs)("div",{className:"flex flex-row items-start gap-1 sm:gap-2",children:[(0,n.jsx)(_,{autoFocus:!0,className:"grow resize-none border-0! border-none! bg-transparent p-2 text-sm outline-none ring-0 [-ms-overflow-style:none] [scrollbar-width:none] placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-0 focus-visible:ring-offset-0 [&::-webkit-scrollbar]:hidden","data-testid":"multimodal-input",disableAutoResize:!0,maxHeight:200,minHeight:44,onChange:e=>{r(e.target.value)},placeholder:"Send a message...",ref:k,rows:1,value:s})," ",(0,n.jsx)(x,{...A})]}),(0,n.jsxs)(V,{className:"!border-top-0 border-t-0! p-0 shadow-none dark:border-0 dark:border-transparent!",children:[(0,n.jsxs)(L,{className:"gap-0 sm:gap-0.5",children:[(0,n.jsx)(G,{fileInputRef:z,selectedModelId:y,status:a}),(0,n.jsx)(Q,{onModelChange:(e,t)=>{null==j||j(e,t)},selectedModelId:y,selectedProviderId:b})]}),"submitted"===a?(0,n.jsx)(Y,{setMessages:h,stop:u}):(0,n.jsx)(F,{className:"size-8 rounded-full bg-primary text-primary-foreground transition-colors duration-200 hover:bg-primary/90 disabled:bg-muted disabled:text-muted-foreground",disabled:!s.trim()||E.length>0,status:a,children:(0,n.jsx)(O.Kp,{size:14})})]})]})]})},(e,t)=>e.input===t.input&&e.status===t.status&&!!a()(e.attachments,t.attachments)&&e.selectedModelId===t.selectedModelId&&e.selectedProviderId===t.selectedProviderId&&!!a()(e.usage,t.usage)),G=(0,i.memo)(function(e){let{fileInputRef:t,status:s,selectedModelId:r}=e;return(0,n.jsx)(w.$,{className:"aspect-square h-8 rounded-lg p-1 transition-colors hover:bg-accent","data-testid":"attachments-button",disabled:"idle"!==s&&"ready"!==s,onClick:e=>{var s;e.preventDefault(),null==(s=t.current)||s.click()},variant:"ghost",children:(0,n.jsx)(O.Au,{size:14,style:{width:14,height:14}})})}),Q=(0,i.memo)(function(e){let{selectedModelId:t,selectedProviderId:s,onModelChange:r}=e;return(0,n.jsx)("div",{className:"w-full",children:(0,n.jsx)(H,{onValueChange:(e,t)=>{null==r||r(t,e)},value:s})})},(e,t)=>e.selectedModelId===t.selectedModelId&&e.selectedProviderId===t.selectedProviderId&&e.onModelChange===t.onModelChange),Y=(0,i.memo)(function(e){let{stop:t,setMessages:s}=e;return(0,n.jsx)(w.$,{className:"size-7 rounded-full bg-foreground p-1 text-background transition-colors duration-200 hover:bg-foreground/90 disabled:bg-muted disabled:text-muted-foreground","data-testid":"stop-button",onClick:e=>{e.preventDefault(),t(),s(e=>e)},children:(0,n.jsx)(O.wF,{size:14})})})},30214:(e,t,s)=>{s.d(t,{u:()=>n}),s(98089),s(39485);function n(){return{dataStream:[],setDataStream:()=>{}}}},32621:(e,t,s)=>{s.d(t,{P7:()=>n});class n extends Error{toResponse(){return new Response(JSON.stringify({error:this.message}),{status:400,headers:{"Content-Type":"application/json"}})}constructor(e){super(e),this.name="ChatSDKError"}}TransformStream},33510:(e,t,s)=>{s.d(t,{r:()=>Q});var n=s(98089),r=s(29501),a=s(39485),i=s(61391),o=s(59145),l=s(23625),d=s(53047),c=s(55928);function u(e){let{className:t}=e,{toggleSidebar:s}=(0,o.cL)();return(0,n.jsxs)(l.m_,{children:[(0,n.jsx)(l.k$,{asChild:!0,children:(0,n.jsx)(c.$,{className:(0,d.cn)("h-8 px-2 md:h-fit md:px-2",t),"data-testid":"sidebar-toggle-button",onClick:s,variant:"outline",children:(0,n.jsx)(i.j0,{size:16})})}),(0,n.jsx)(l.ZI,{align:"start",className:"hidden md:block",children:"Toggle Sidebar"})]})}var m=s(39528),p=s.n(m),f=s(74261);function h(e){let{className:t}=e,[s,r]=(0,a.useState)(!1);return(0,n.jsxs)(f.rI,{onOpenChange:r,open:s,children:[(0,n.jsx)(f.ty,{asChild:!0,className:(0,d.cn)("w-fit data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t),children:(0,n.jsxs)(c.$,{className:"hidden h-8 focus-visible:outline-none focus-visible:ring-0 focus-visible:ring-offset-0 md:flex md:h-fit md:px-2","data-testid":"tools-menu",variant:"outline",children:[(0,n.jsx)(i.lo,{}),(0,n.jsx)("span",{className:"md:sr-only",children:"Tools"}),(0,n.jsx)(i.D3,{})]})}),(0,n.jsxs)(f.SQ,{align:"start",className:"min-w-[300px]",children:[(0,n.jsx)(f._2,{asChild:!0,children:(0,n.jsxs)(p(),{className:"flex flex-col items-start gap-1",href:"https://gigamaster.github.io/livecodes/",target:"_blank",children:[(0,n.jsx)("span",{children:"Live Code Editor"}),(0,n.jsx)("div",{className:"text-muted-foreground text-xs",children:"Interactive coding environment"})]})}),(0,n.jsx)(f._2,{asChild:!0,children:(0,n.jsxs)(p(),{className:"flex flex-col items-start gap-1",href:"https://gigamaster.github.io/codemo",target:"_blank",children:[(0,n.jsx)("span",{children:"Codemo Digital Nomad"}),(0,n.jsx)("div",{className:"text-muted-foreground text-xs",children:"Tools for digital nomads"})]})})]})]})}var g=s(25159),x=s(12796),v=s(45459);let y=(0,a.memo)(function(e){let{isReadonly:t}=e,s=(0,r.useRouter)();(0,r.usePathname)();let{open:d}=(0,o.cL)(),{lock:m,hasPassword:p}=(0,x.V)(),f=(0,v.a)(),[y,b]=(0,a.useState)(!1);return(0,n.jsxs)("header",{className:"sticky top-0 flex items-center gap-2 bg-background px-2 py-1.5 md:px-2",children:[(0,n.jsx)(u,{}),(!d||f)&&(0,n.jsxs)(c.$,{className:"order-2 ml-auto h-8 px-2 md:order-1 md:ml-0 md:h-fit md:px-2",onClick:()=>{s.push("/"),s.refresh()},variant:"outline",children:[(0,n.jsx)(i.c1,{}),(0,n.jsx)("span",{className:"md:sr-only",children:"New Chat"})]}),!t&&(0,n.jsx)(h,{className:"order-1 md:order-2"}),(0,n.jsxs)("div",{className:"order-2 ml-auto flex items-center gap-2 md:order-3",children:[(0,n.jsxs)(c.$,{className:"h-8 px-2 md:h-fit",onClick:()=>b(!0),variant:"outline",children:[(0,n.jsx)(i.mo,{size:16}),(0,n.jsx)("span",{className:"sr-only md:not-sr-only md:ml-2",children:"About"})]}),(0,n.jsx)(l.Bc,{children:(0,n.jsxs)(l.m_,{children:[(0,n.jsx)(l.k$,{asChild:!0,children:(0,n.jsxs)(c.$,{className:"h-8 px-2 md:h-fit",onClick:()=>{m()},variant:"outline",children:[(0,n.jsx)(i.XA,{size:16}),(0,n.jsx)("span",{className:"sr-only md:not-sr-only md:ml-2",children:"Lock"})]})}),(0,n.jsx)(l.ZI,{children:p?"Lock your session":"Set a password first in the user menu"})]})})]}),(0,n.jsx)(g.Lt,{onOpenChange:b,open:y,children:(0,n.jsxs)(g.EO,{children:[(0,n.jsxs)(g.wd,{children:[(0,n.jsx)(g.r7,{children:"About AI Chatbot"}),(0,n.jsx)(g.$v,{asChild:!0,children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{children:"AI Chatbot is a client-side only application that runs entirely in your browser. Your data is stored locally and never sent to any external servers."}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"How to Use:"}),(0,n.jsxs)("ul",{className:"ml-4 list-disc space-y-1",children:[(0,n.jsx)("li",{children:"You need an API Key from your provider."}),(0,n.jsxs)("li",{children:["For example, visit"," ",(0,n.jsx)("a",{className:"text-primary hover:text-blue-400",href:"https://aistudio.google.com/api-keys",rel:"noopener",target:"_blank",children:"Google AI Studio"})," ","to generate an API Key"]}),(0,n.jsx)("li",{children:"You also need an OpenAI Compatible Endpoint and a Model."}),(0,n.jsxs)("li",{children:["For example, visit the"," ",(0,n.jsx)("a",{className:"text-primary hover:text-blue-400",href:"https://ai.google.dev/gemini-api/docs/openai",rel:"noopener",target:"_blank",children:"Google documentation"})," ","to learn more about using the Gemini API with an OpenAI compatible endpoint."]}),(0,n.jsxs)("li",{children:["Default base url:"," ",(0,n.jsx)("code",{className:"text-xs",children:"https://generativelanguage.googleapis.com/v1beta/openai/"})]})]})]}),(0,n.jsx)("div",{children:(0,n.jsxs)("ul",{className:"ml-4 list-disc space-y-1",children:[(0,n.jsx)("li",{children:"Go to Settings and add a new AI Provider"}),(0,n.jsx)("li",{children:"Start Chatting"}),(0,n.jsx)("li",{children:"Choose your preferred model from the dropdown menu"}),(0,n.jsx)("li",{children:"Your conversations are automatically saved locally"})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Credits:"}),(0,n.jsxs)("ul",{className:"ml-4 list-disc space-y-1",children:[(0,n.jsx)("li",{children:"Built with Next.js and React"}),(0,n.jsx)("li",{children:"UI components from shadcn/ui"}),(0,n.jsx)("li",{children:"Icons from Lucide React"}),(0,n.jsx)("li",{children:"Local database powered by IndexedDB"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Version:"}),(0,n.jsxs)("div",{children:["Version ","1.1.0"," ","built for Client-side Rendering"]})]}),(0,n.jsx)("div",{className:"text-muted-foreground text-xs",children:"\xa9 2025 AI-chatbot Codemo Digital Nomad by Nuno Luciano."})]})})]}),(0,n.jsx)(g.ck,{children:(0,n.jsx)(g.Rx,{onClick:()=>b(!1),children:"Close"})})]})})]})},(e,t)=>e.chatId===t.chatId&&e.isReadonly===t.isReadonly);var b=s(45647),j=s(91639),w=s(32621),k=s(98120);function N(e){try{let t=e.parts.filter(e=>"text"===e.type).map(e=>e.text).join(" ").trim();if(t){let e=t.substring(0,50);return t.length>50&&(e+="..."),e||"New Chat"}return"New Chat"}catch(e){return console.error("Error generating title:",e),"New Chat"}}async function C(e,t){try{let n=(0,k.F6)();if(!n)return null;let r="";try{r=await N(t)}catch(e){r="New Chat"}r&&""!==r.trim()||(r="New Chat");let{saveLocalChat:a}=await Promise.resolve().then(s.bind(s,83415)),i=await a({id:e,userId:n,title:r});return window.dispatchEvent(new CustomEvent("chatSaved",{detail:{chatId:e,userId:n}})),window.dispatchEvent(new CustomEvent("chatSaved")),i}catch(e){return console.error("Error saving chat:",e),null}}async function S(e,t){try{let n=t.map(t=>{var s;return{id:t.id,chatId:e,role:t.role,parts:t.parts,attachments:[],createdAt:new Date((null==(s=t.metadata)?void 0:s.createdAt)||Date.now())}}),{saveLocalMessages:r}=await Promise.resolve().then(s.bind(s,83415));await r({messages:n})}catch(e){console.error("Error saving messages to IndexedDB:",e)}}async function I(e){try{let{getLocalChat:t}=await Promise.resolve().then(s.bind(s,91502));return!!await t(e)}catch(e){return console.error("Error checking if chat exists:",e),!1}}var T=s(97229),z=s(12857),E=s(54420);async function P(e,t){if(await Promise.resolve(),!e.body)throw Error("Response has no body");let s=e.body.getReader(),n=new TextDecoder,r="";return new ReadableStream({async pull(e){try{let{done:o,value:l}=await s.read();if(o){let t="data: ".concat(JSON.stringify({type:"data-finish",data:null,transient:!0}),"\n\n");e.enqueue(new TextEncoder().encode(t)),e.close();return}let d=(r+=n.decode(l,{stream:!0})).split("\n");for(let s of(r=d.pop()||"",d))if(s.startsWith("data: ")){let n=s.slice(6);if("[DONE]"===n){let t="data: ".concat(JSON.stringify({type:"data-finish",data:null,transient:!0}),"\n\n");e.enqueue(new TextEncoder().encode(t)),e.close();return}try{var a,i;let s=JSON.parse(n);if(s.usage||s.usage_metadata){let n=s.usage||s.usage_metadata,r=n.prompt_token_count||n.prompt_tokens||0,a=n.candidates_token_count||n.completion_tokens||0,i=n.total_token_count||n.total_tokens||r+a,o="data: ".concat(JSON.stringify({type:"data-usage",data:{inputTokens:r,outputTokens:a,totalTokens:i,promptTokens:r,completionTokens:a,modelId:t},transient:!0}),"\n\n");e.enqueue(new TextEncoder().encode(o))}if(null==(i=s.choices)||null==(a=i[0])?void 0:a.delta){let t=s.choices[0].delta.content;if(t){let s="data: ".concat(JSON.stringify({type:"text-delta",textDelta:t,transient:!1}),"\n\n");e.enqueue(new TextEncoder().encode(s))}}}catch(e){console.error("Error parsing SSE data:",e)}}}catch(n){let t=n instanceof Error?n.message:String(n),s="data: ".concat(JSON.stringify({type:"data-error",data:t,transient:!0}),"\n\n");e.enqueue(new TextEncoder().encode(s)),e.error(n)}},async cancel(){await s.cancel()}})}class M{async sendMessages(e){try{var t,s,n;let r=e.selectedProviderId||(null==(t=e.body)?void 0:t.selectedProviderId),a=e.selectedModelId||(null==(s=e.body)?void 0:s.selectedModelId),i=e.id||(null==(n=e.body)?void 0:n.id),o=e.message;if(!r)throw new T.P7("bad_request:chat","No provider selected");if(!a)throw new T.P7("bad_request:chat","No model selected");if(!i)throw new T.P7("bad_request:chat","No chat ID provided");let l=await (0,z.US)(r);if(!l)throw new T.P7("bad_request:chat","Provider not found: ".concat(r));if(!l.baseUrl||!l.apiKey)throw new T.P7("bad_request:chat","Provider configuration is incomplete");if(!(0,k.F6)())throw new T.P7("bad_request:chat","User not authenticated");let d="";try{d=await N(o)}catch(e){console.error("Error generating title:",e),d="New Chat"}d&&""!==d.trim()||(d="New Chat");let c=[o].map(e=>({role:e.role,content:e.parts.filter(e=>"text"===e.type).map(e=>e.text).join("\n")})),u=await (0,E.ml)("enableDataStreamUsage"),m={model:a,messages:c,stream:!0};u&&(m.stream_options={include_usage:!0});let p={"Content-Type":"application/json",Authorization:"Bearer ".concat(l.apiKey)},f=l.baseUrl,h="chat/completions",g=f.endsWith("/")?"".concat(f).concat(h):"".concat(f,"/").concat(h),x=await fetch(g,{method:"POST",headers:p,body:JSON.stringify(m)});if(!x.ok){let e=await x.text(),t="HTTP ".concat(x.status,": ").concat(x.statusText);throw 401===x.status?t="Authentication Failed (401). Check your API Key.":404===x.status?t="Not Found (404). Check the Base URL and Model Name.":e.includes("API key")&&(t="Invalid API key"),new T.P7("bad_request:chat",t)}let v=await P(x,a);return new Response(v,{status:200,headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}catch(e){if(e instanceof T.P7)throw e;throw new T.P7("bad_request:chat",e.message||"Failed to send message")}}}let A=new M;var R=s(68320),D=s(78672),_=s(68693),V=s.n(_),L=s(62005),F=s(60719),O=s(40827),U=s(30214),q=s(74901);let H=e=>{let{className:t,...s}=e;return(0,n.jsx)(q.z,{className:(0,d.cn)("relative flex-1 touch-pan-y overflow-y-auto will-change-scroll",t),initial:"smooth",resize:"smooth",role:"log",...s})},W=e=>{let{className:t,...s}=e;return(0,n.jsx)(q.z.Content,{className:(0,d.cn)("p-4",t),...s})};var B=s(72153);let $=()=>(0,n.jsxs)("div",{className:"mx-auto mt-4 flex size-full max-w-3xl flex-col justify-center px-4 md:mt-16 md:px-8",children:[(0,n.jsx)(B.P.div,{animate:{opacity:1,y:0},className:"font-semibold text-xl md:text-2xl",exit:{opacity:0,y:10},initial:{opacity:0,y:10},transition:{delay:.5},children:"Welcome to AI Chatbot of Codemo Digital Nomad!"}),(0,n.jsx)(B.P.div,{animate:{opacity:1,y:0},className:"text-xl text-zinc-500 md:text-2xl",exit:{opacity:0,y:10},initial:{opacity:0,y:10},transition:{delay:.6},children:"How can I help you today?"})]},"overview");var K=s(94456);let Z=(0,a.memo)(function(e){let{chatId:t,status:s,votes:r,messages:i,setMessages:o,regenerate:l,isReadonly:d,selectedModelId:c}=e,{containerRef:u,endRef:m,isAtBottom:p,scrollToBottom:f,hasSentMessage:h}=(0,O.o)({status:s});return(0,U.u)(),(0,a.useEffect)(()=>{"submitted"===s&&requestAnimationFrame(()=>{let e=u.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})})},[s,u]),(0,n.jsxs)("div",{className:"overscroll-behavior-contain -webkit-overflow-scrolling-touch flex-1 touch-pan-y overflow-y-scroll",ref:u,style:{overflowAnchor:"none"},children:[(0,n.jsx)(H,{className:"mx-auto flex min-w-0 max-w-4xl flex-col gap-4 md:gap-6",children:(0,n.jsxs)(W,{className:"flex flex-col gap-4 px-2 py-4 md:gap-6 md:px-4",children:[0===i.length&&(0,n.jsx)($,{}),i.map((e,a)=>(0,n.jsx)(K.e,{chatId:t,isLoading:"streaming"===s&&i.length-1===a,isReadonly:d,message:e,regenerate:l,requiresScrollPadding:h&&a===i.length-1,setMessages:o,vote:r?r.find(t=>t.messageId===e.id):void 0},e.id)),(0,n.jsx)(L.N,{mode:"wait",children:"submitted"===s&&(0,n.jsx)(K.q,{},"thinking")}),(0,n.jsx)("div",{className:"min-h-[24px] min-w-[24px] shrink-0",ref:m})]})}),!p&&(0,n.jsx)("button",{"aria-label":"Scroll to bottom",className:"-translate-x-1/2 absolute bottom-40 left-1/2 z-10 rounded-full border bg-background p-2 shadow-lg transition-colors hover:bg-muted",onClick:()=>f("smooth"),type:"button",children:(0,n.jsx)(F.A,{className:"size-4"})})]})},(e,t)=>!!e.isArtifactVisible&&!!t.isArtifactVisible||e.status===t.status&&e.selectedModelId===t.selectedModelId&&e.messages.length===t.messages.length&&!!V()(e.messages,t.messages)&&(!V()(e.votes,t.votes),!1));var J=s(19564),G=s(38960);function Q(e){let{id:t,initialMessages:s,initialChatModel:i,isReadonly:o,initialLastContext:l,initialProviderId:c}=e,[u,m]=(0,a.useState)(""),[p,f]=(0,a.useState)(l),[h,g]=(0,a.useState)(i),[x,v]=(0,a.useState)(c||null);(0,a.useEffect)(()=>{let e=async()=>{try{let e=await R.Go.getUsageStats(),t="",s={inputTokens:0,outputTokens:0,totalTokens:0},n=0;for(let[r,a]of Object.entries(e.byModel))a.tokens>n&&(n=a.tokens,t=r,s={inputTokens:a.inputTokens||0,outputTokens:a.outputTokens||0,totalTokens:a.tokens||0});f({inputTokens:s.inputTokens,outputTokens:s.outputTokens,totalTokens:s.totalTokens,promptTokens:s.inputTokens,completionTokens:s.outputTokens,modelId:t})}catch(e){console.error("Failed to load initial usage data:",e)}};l||e()},[l]);let k=(0,a.useRef)(h),N=(0,a.useRef)(x);(0,a.useEffect)(()=>{k.current=h},[h]),(0,a.useEffect)(()=>{N.current=x},[x]),(0,a.useEffect)(()=>{(async()=>{try{let e=await (0,z.getAllProviders)();if(c&&e.find(e=>e.id===c))return void v(c);let t=e.filter(e=>e.model===i);t.length>0&&v(t[0].id)}catch(e){console.error("Error initializing provider ID:",e)}})()},[i,c]);let{messages:T,stop:E,regenerate:P,sendMessage:M,setMessages:_,status:V}=function(e){let[t,s]=(0,a.useState)(()=>e.messages||[]),[n,r]=(0,a.useState)("idle"),i=(0,a.useRef)(null),o=(0,a.useRef)([]);(0,a.useEffect)(()=>{t.length>0&&e.id&&I(e.id).then(s=>{s&&S(e.id,t)})},[t,e.id]),(0,a.useEffect)(()=>{e.messages&&e.messages.length>0&&(t.length===e.messages.length&&t.every((t,s)=>t.id===e.messages[s].id&&t.role===e.messages[s].role)||s(e.messages))},[e.messages,t.every,t.length]);let l=(0,a.useRef)(e.id);(0,a.useEffect)(()=>{l.current=e.id},[e.id]);let c=(0,a.useCallback)(async(e,n)=>{try{var a,i,o,c;let u;r("submitted");let m={id:e.id||(0,d.lk)(),role:e.role||"user",parts:e.parts||(e.text?[{type:"text",text:e.text}]:[]),metadata:e.metadata||{createdAt:new Date().toISOString()}};s(e=>[...e,m]);let p={id:(null==n?void 0:n.id)||(null==n?void 0:n.chatId)||(null==n||null==(a=n.body)?void 0:a.id)||l.current,message:m,body:{selectedProviderId:(null==n?void 0:n.selectedProviderId)||(null==n||null==(i=n.body)?void 0:i.selectedProviderId),selectedModelId:(null==n?void 0:n.selectedModelId)||(null==n||null==(o=n.body)?void 0:o.selectedModelId)}};r("loading");let f=await A.sendMessages(p);if(!f.ok)throw Error("HTTP error! status: ".concat(f.status));if(!f.body)throw Error("Response body is null");let h=f.body.getReader(),g=new TextDecoder,x=t.at(-1);x&&"assistant"===x.role?u=x:(u={id:(0,d.lk)(),role:"assistant",parts:[],metadata:{createdAt:new Date().toISOString()}},s(e=>[...e,u])),r("streaming");let v=!1;try{for(;;){let{done:e,value:t}=await h.read();if(e)break;for(let e of g.decode(t).split("\n"))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)break;try{let e=JSON.parse(t);if("text-delta"===e.type){let t=e.textDelta||"";t&&(s(e=>{let s=[...e],n=s.length-1,r=s[n];if("assistant"===r.role){let e=r.parts.length-1;if(0===r.parts.length){let e={...r,parts:[{type:"text",text:t}]};s[n]=e}else if(e>=0&&"text"===r.parts[e].type){let a=r.parts[e].text+t,i={...r,parts:r.parts.map((t,s)=>s===e?{...t,text:a}:t)};s[n]=i}else{let e={...r,parts:[...r.parts,{type:"text",text:t}]};s[n]=e}}else{let e={id:(0,d.lk)(),role:"assistant",parts:[{type:"text",text:t}],metadata:{createdAt:new Date().toISOString()}};s.push(e)}return s}),v||(v=!0,await C((null==n?void 0:n.id)||(null==n?void 0:n.chatId)||(null==n||null==(c=n.body)?void 0:c.id)||l.current,m)),(null==n?void 0:n.onData)&&n.onData(e))}else if("data-usage"===e.type){let t=e.data,s=(null==n?void 0:n.selectedModelId)||"unknown-model";if(R.Z_.recordModelUsage(s,t.inputTokens||0,t.outputTokens||0),null==n?void 0:n.onUsageUpdate){let e=n.onUsageUpdate(t);e instanceof Promise&&await e}(null==n?void 0:n.onData)&&n.onData(e)}else if("data-finish"===e.type)break;else if("data-error"===e.type)throw Error(e.data||"Unknown error from LLM")}catch(e){console.warn("Failed to parse SSE data:",t),console.error("SSE parsing error:",e)}}}}catch(e){throw console.error("Error processing SSE stream:",e),e}finally{h.releaseLock()}(null==n?void 0:n.onFinish)&&n.onFinish(),r("idle")}catch(t){r("error"),console.error("Error processing message:",t);let e={id:(0,d.lk)(),role:"assistant",parts:[{type:"text",text:"Sorry, I encountered an error: ".concat(t.message||"Unknown error")}],metadata:{createdAt:new Date().toISOString()}};if(s(t=>[...t,e]),null==n?void 0:n.onError)try{n.onError(t)}catch(e){console.error("Error in onError handler:",e)}}},[t]);(0,a.useEffect)(()=>{if(o.current.length>0&&"loading"!==n&&"streaming"!==n&&"submitted"!==n){let e=o.current.shift();e&&c(e.message,e.options)}},[n,c]);let u=(0,a.useCallback)(async(e,t)=>{if(e&&(o.current.push({message:e,options:t}),"loading"!==n&&"streaming"!==n&&"submitted"!==n)){let e=o.current.shift();e&&await c(e.message,e.options)}},[n,c]),m=(0,a.useCallback)(async()=>{i.current&&(i.current.abort(),r("idle"),await Promise.resolve())},[]),p=(0,a.useCallback)(async e=>{let t=null==e?void 0:e.messageId;s(s=>{let n=s.findIndex(e=>e.id===t);if(n>0){let t=s[n-1];if("user"===t.role){let r=s.slice(0,n);return u(t,e),r}}return s}),await Promise.resolve()},[u]);return{messages:t,setMessages:s,sendMessage:u,status:n,stop:m,regenerate:p,resumeStream:(0,a.useCallback)(async()=>{console.log("Resume stream called, but not implemented"),await Promise.resolve()},[])}}({id:t,messages:s,experimental_throttle:100,generateId:d.lk,onData:e=>{if("data-usage"===e.type){var t;let s=(null==(t=e.data)?void 0:t.data)||e.data;s&&f({inputTokens:s.inputTokens||0,outputTokens:s.outputTokens||0,totalTokens:s.totalTokens||s.inputTokens+s.outputTokens||0,promptTokens:s.promptTokens||s.inputTokens||0,completionTokens:s.completionTokens||s.outputTokens||0,modelId:s.modelId||""})}},onUsageUpdate:async e=>{if(e)f(t=>({inputTokens:e.inputTokens||(null==t?void 0:t.inputTokens)||0,outputTokens:e.outputTokens||(null==t?void 0:t.outputTokens)||0,totalTokens:(e.inputTokens||(null==t?void 0:t.inputTokens)||0)+(e.outputTokens||(null==t?void 0:t.outputTokens)||0),promptTokens:e.promptTokens||e.inputTokens||(null==t?void 0:t.promptTokens)||(null==t?void 0:t.inputTokens)||0,completionTokens:e.completionTokens||e.outputTokens||(null==t?void 0:t.completionTokens)||(null==t?void 0:t.outputTokens)||0,modelId:e.modelId||(null==t?void 0:t.modelId)||""}));else{let e=await R.Go.getUsageStats(),t="",s={inputTokens:0,outputTokens:0,totalTokens:0},n=0;for(let[r,a]of Object.entries(e.byModel))a.tokens>n&&(n=a.tokens,t=r,s={inputTokens:a.inputTokens||0,outputTokens:a.outputTokens||0,totalTokens:a.tokens||0});f({inputTokens:s.inputTokens,outputTokens:s.outputTokens,totalTokens:s.totalTokens,promptTokens:s.inputTokens,completionTokens:s.outputTokens,modelId:t})}},onFinish:()=>{console.log("Stream finished, chat saving handled elsewhere")},onError:e=>{e instanceof w.P7&&(0,G.o)({type:"error",description:e.message})}}),L=(0,r.useSearchParams)().get("query"),[F,O]=(0,a.useState)(!1);(0,a.useEffect)(()=>{L&&!F&&(M({text:L}),O(!0),window.history.replaceState({},"","/chat/".concat(t)))},[L,M,F,t]);let U=void 0,[q,H]=(0,a.useState)([]),W=(0,b.HO)(e=>e.isVisible);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"overscroll-behavior-contain flex h-dvh min-w-0 touch-pan-y flex-col bg-background",children:[(0,n.jsx)(y,{chatId:t,isReadonly:o}),(0,n.jsx)(Z,{chatId:t,isArtifactVisible:W,isReadonly:o,messages:T,regenerate:P,selectedModelId:i,setMessages:_,status:V,votes:U}),(0,n.jsx)("div",{className:"sticky bottom-0 z-1 mx-auto flex w-full max-w-4xl gap-2 border-t-0 bg-background px-2 pb-3 md:px-4 md:pb-4",children:!o&&(0,n.jsx)(J.Z,{attachments:q,chatId:t,input:u,messages:T,onModelChange:(e,t)=>{g(e),t?(v(t),(0,a.startTransition)(()=>{(0,j.HV)(e,t)})):(0,a.startTransition)(()=>{(0,j.HV)(e)})},selectedModelId:h,selectedProviderId:x||void 0,sendMessage:M,setAttachments:H,setInput:m,setMessages:_,status:V,stop:E,usage:p})})]}),(0,n.jsx)(D.FV,{attachments:q,chatId:t,input:u,isReadonly:o,messages:T,regenerate:P,selectedModelId:h,sendMessage:M,setAttachments:H,setInput:m,setMessages:_,status:V,stop:E,votes:U})]})}},38960:(e,t,s)=>{s.d(t,{o:()=>d});var n=s(98089),r=s(39485),a=s(70469),i=s(53047),o=s(61391);let l={success:(0,n.jsx)(o.PW,{}),error:(0,n.jsx)(o.id,{})};function d(e){return a.o.custom(t=>(0,n.jsx)(c,{description:e.description,id:t,type:e.type}))}function c(e){let{id:t,type:s,description:a}=e,o=(0,r.useRef)(null),[d,c]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=o.current;if(!e)return;let t=()=>{let t=Number.parseFloat(getComputedStyle(e).lineHeight);c(Math.round(e.scrollHeight/t)>1)};t();let s=new ResizeObserver(t);return s.observe(e),()=>s.disconnect()},[]),(0,n.jsx)("div",{className:"flex toast-mobile:w-[356px] w-full justify-center",children:(0,n.jsxs)("div",{className:(0,i.cn)("flex toast-mobile:w-fit w-full flex-row gap-3 rounded-lg bg-zinc-100 p-3",d?"items-start":"items-center"),"data-testid":"toast",children:[(0,n.jsx)("div",{className:(0,i.cn)("data-[type=error]:text-red-600 data-[type=success]:text-green-600",{"pt-1":d}),"data-type":s,children:l[s]}),(0,n.jsx)("div",{className:"text-sm text-zinc-950",ref:o,children:a})]},t)})}},40827:(e,t,s)=>{s.d(t,{o:()=>a});var n=s(39485),r=s(11905);function a(e){let{status:t}=e,{containerRef:s,endRef:a,isAtBottom:i,scrollToBottom:o,onViewportEnter:l,onViewportLeave:d}=function(){let e=(0,n.useRef)(null),t=(0,n.useRef)(null),[s,a]=(0,n.useState)(!0),{data:i=!1,mutate:o}=(0,r.Ay)("messages:should-scroll",null,{fallbackData:!1}),l=(0,n.useCallback)(()=>{if(!e.current)return;let{scrollTop:t,scrollHeight:s,clientHeight:n}=e.current;a(t+n>=s-100)},[]);return(0,n.useEffect)(()=>{if(!e.current)return;let t=e.current,s=new ResizeObserver(()=>{requestAnimationFrame(()=>{l()})}),n=new MutationObserver(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{l()})})});return s.observe(t),n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class","data-state"]}),l(),()=>{s.disconnect(),n.disconnect()}},[l]),(0,n.useEffect)(()=>{let t=e.current;if(t)return t.addEventListener("scroll",l),l(),()=>{t.removeEventListener("scroll",l)}},[l]),(0,n.useEffect)(()=>{if(i&&e.current){let t=e.current,s={top:t.scrollHeight,behavior:i};t.scrollTo(s),o(!1)}},[i,o]),{containerRef:e,endRef:t,isAtBottom:s,scrollToBottom:(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"smooth";o(e)},[o]),onViewportEnter:function(){a(!0)},onViewportLeave:function(){a(!1)}}}(),[c,u]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{"submitted"===t&&u(!0)},[t]),{containerRef:s,endRef:a,isAtBottom:i,scrollToBottom:o,onViewportEnter:l,onViewportLeave:d,hasSentMessage:c}}},45647:(e,t,s)=>{s.d(t,{HO:()=>i,ST:()=>o,ls:()=>a});var n=s(39485),r=s(11905);let a={documentId:"init",content:"",kind:"text",title:"",status:"idle",isVisible:!1,boundingBox:{top:0,left:0,width:0,height:0}};function i(e){let{data:t}=(0,r.Ay)("artifact",null,{fallbackData:a});return(0,n.useMemo)(()=>t?e(t):e(a),[t,e])}function o(){let{data:e,mutate:t}=(0,r.Ay)("artifact",null,{fallbackData:a}),s=(0,n.useMemo)(()=>e||a,[e]),i=(0,n.useCallback)(e=>{t(t=>{let s=t||a;return"function"==typeof e?e(s):e})},[t]),{data:o,mutate:l}=(0,r.Ay)(()=>s.documentId?"artifact-metadata-".concat(s.documentId):null,null,{fallbackData:null});return(0,n.useMemo)(()=>({artifact:s,setArtifact:i,metadata:o,setMetadata:l}),[s,i,o,l])}},54506:(e,t,s)=>{s.d(t,{T:()=>i});var n=s(98089),r=s(39485),a=s(53047);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});i.displayName="Textarea"},56357:(e,t,s)=>{s.d(t,{uj:()=>a});var n=s(18755);let r=async(e,t)=>{try{let r,a;if(t)r=e,a=t;else{a=e;let{getProviders:t}=await s.e(2329).then(s.bind(s,22329)),i=(await t()).find(e=>e.model===a);if(i)r=i.id;else{let e=(0,n.UT)(a);r=(null==e?void 0:e.provider)||"google"}}let{getProviderConfig:i}=await s.e(2329).then(s.bind(s,22329)),o=await i(r),l={service:"openai",model:a,stream:!0};return o&&(o.apiKey&&(l.apiKey=o.apiKey),o.baseUrl&&(l.baseUrl=o.baseUrl)),new(await s.e(9022).then(s.bind(s,56068))).default(l)}catch(e){throw console.error("=== FAILED to create language model ==="),console.error("Error:",e),console.error("Error stack:",e.stack),Error("Failed to create language model: ".concat(e.message))}},a=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";try{let t=e;return"default"===e&&(t=n.jq),await r(t)}catch(e){throw console.error("=== FAILED to get language model ==="),console.error("Error:",e),console.error("Error stack:",e.stack),Error("Failed to get language model. Please check your provider configuration.")}}},59278:(e,t,s)=>{s.d(t,{Y:()=>o});var n=s(98089),r=s(39485),a=s(3349),i=s(53047);let o=(0,r.memo)(e=>{let{className:t,...s}=e;return(0,n.jsx)(a.jH,{className:(0,i.cn)("size-full [&>*:first-child]:mt-0 [&>*:last-child]:mb-0 [&_code]:whitespace-pre-wrap [&_code]:break-words [&_pre]:max-w-full [&_pre]:overflow-x-auto",t),...s})},(e,t)=>e.children===t.children);o.displayName="Response"},66581:(e,t,s)=>{s.d(t,{q:()=>l});var n=s(98089),r=s(71840),a=s(75422),i=s(61391),o=s(55928);let l=e=>{let{attachment:t,isUploading:s=!1,onRemove:l}=e,{name:d,url:c,contentType:u}=t;return(0,n.jsxs)("div",{className:"group relative size-16 overflow-hidden rounded-lg border bg-muted","data-testid":"input-attachment-preview",children:[(null==u?void 0:u.startsWith("image"))?(0,n.jsx)(r.default,{alt:null!=d?d:"An image attachment",className:"size-full object-cover",height:64,src:c,width:64}):(0,n.jsx)("div",{className:"flex size-full items-center justify-center text-muted-foreground text-xs",children:"File"}),s&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:(0,n.jsx)(a.a,{size:16})}),l&&!s&&(0,n.jsx)(o.$,{className:"absolute top-0.5 right-0.5 size-4 rounded-full p-0 opacity-0 transition-opacity group-hover:opacity-100",onClick:l,size:"sm",variant:"destructive",children:(0,n.jsx)(i.Fj,{size:8})}),(0,n.jsx)("div",{className:"absolute inset-x-0 bottom-0 truncate bg-linear-to-t from-black/80 to-transparent px-1 py-0.5 text-[10px] text-white",children:d})]})}},75422:(e,t,s)=>{s.d(t,{a:()=>i});var n=s(98089),r=s(53047);let a=e=>{let{size:t=16}=e;return(0,n.jsxs)("svg",{height:t,strokeLinejoin:"round",style:{color:"currentcolor"},viewBox:"0 0 16 16",width:t,children:[(0,n.jsx)("title",{children:"Loader"}),(0,n.jsxs)("g",{clipPath:"url(#clip0_2393_1490)",children:[(0,n.jsx)("path",{d:"M8 0V4",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M8 16V12",opacity:"0.5",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M3.29773 1.52783L5.64887 4.7639",opacity:"0.9",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M12.7023 1.52783L10.3511 4.7639",opacity:"0.1",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M12.7023 14.472L10.3511 11.236",opacity:"0.4",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M3.29773 14.472L5.64887 11.236",opacity:"0.6",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M15.6085 5.52783L11.8043 6.7639",opacity:"0.2",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M0.391602 10.472L4.19583 9.23598",opacity:"0.7",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M15.6085 10.4722L11.8043 9.2361",opacity:"0.3",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M0.391602 5.52783L4.19583 6.7639",opacity:"0.8",stroke:"currentColor",strokeWidth:"1.5"})]}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_2393_1490",children:(0,n.jsx)("rect",{fill:"white",height:"16",width:"16"})})})]})},i=e=>{let{className:t,size:s=16,...i}=e;return(0,n.jsx)("div",{className:(0,r.cn)("inline-flex animate-spin items-center justify-center",t),...i,children:(0,n.jsx)(a,{size:s})})}},78672:(e,t,s)=>{s.d(t,{FV:()=>e8,Rh:()=>e6});var n=s(98089),r=s(60279),a=s(68693),i=s.n(a),o=s(62005),l=s(72153),d=s(39485),c=s(70469),u=s(63091),m=s(36177),p=s(41743),f=s(24747),h=s(74789),g=s(39922),x=s(99313);let v=(0,d.memo)(function(e){let{content:t,onSaveContent:s,status:r}=e,a=(0,d.useRef)(null),i=(0,d.useRef)(null);return(0,d.useEffect)(()=>{if(a.current&&!i.current){let e=f.$t.create({doc:t,extensions:[x.oQ,(0,p.Hg)(),h.bM]});i.current=new g.Lz({state:e,parent:a.current})}return()=>{i.current&&(i.current.destroy(),i.current=null)}},[t]),(0,d.useEffect)(()=>{if(i.current){let e=g.Lz.updateListener.of(e=>{e.docChanged&&e.transactions.find(e=>!e.annotation(f.ZX.remote))&&s(e.state.doc.toString(),!0)}),t=i.current.state.selection,n=f.$t.create({doc:i.current.state.doc,extensions:[x.oQ,(0,p.Hg)(),h.bM,e],selection:t});i.current.setState(n)}},[s]),(0,d.useEffect)(()=>{if(i.current&&t){let e=i.current.state.doc.toString();if("streaming"===r||e!==t){let s=i.current.state.update({changes:{from:0,to:e.length,insert:t},annotations:[f.ZX.remote.of(!0)]});i.current.dispatch(s)}}},[t,r]),(0,n.jsx)("div",{className:"not-prose relative w-full pb-[calc(80dvh)] text-sm",ref:a})},function(e,t){return e.suggestions===t.suggestions&&e.currentVersionIndex===t.currentVersionIndex&&e.isCurrentVersion===t.isCurrentVersion&&("streaming"!==e.status||"streaming"!==t.status)&&e.content===t.content});var y=s(45647),b=s(53047),j=s(75422),w=s(61391),k=s(55928);function N(e){let{consoleOutputs:t,setConsoleOutputs:s}=e,[r,a]=(0,d.useState)(300),[i,o]=(0,d.useState)(!1),l=(0,d.useRef)(null),c=(0,y.HO)(e=>e.isVisible),u=(0,d.useCallback)(()=>{o(!0)},[]),m=(0,d.useCallback)(()=>{o(!1)},[]),p=(0,d.useCallback)(e=>{if(i){let t=window.innerHeight-e.clientY;t>=100&&t<=800&&a(t)}},[i]);return(0,d.useEffect)(()=>(window.addEventListener("mousemove",p),window.addEventListener("mouseup",m),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",m)}),[p,m]),(0,d.useEffect)(()=>{var e;null==(e=l.current)||e.scrollIntoView({behavior:"smooth"})},[]),(0,d.useEffect)(()=>{c||s([])},[c,s]),t.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{"aria-label":"Resize console","aria-orientation":"horizontal","aria-valuemax":800,"aria-valuemin":100,"aria-valuenow":r,className:"fixed z-50 h-2 w-full cursor-ns-resize",onKeyDown:e=>{"ArrowUp"===e.key?a(e=>Math.min(e+10,800)):"ArrowDown"===e.key&&a(e=>Math.max(e-10,100))},onMouseDown:u,role:"slider",style:{bottom:r-4},tabIndex:0}),(0,n.jsxs)("div",{className:(0,b.cn)("fixed bottom-0 z-40 flex w-full flex-col overflow-x-hidden overflow-y-scroll border-zinc-200 border-t bg-zinc-50 dark:border-zinc-700 dark:bg-zinc-900",{"select-none":i}),style:{height:r},children:[(0,n.jsxs)("div",{className:"sticky top-0 z-50 flex h-fit w-full flex-row items-center justify-between border-zinc-200 border-b bg-muted px-2 py-1 dark:border-zinc-700",children:[(0,n.jsxs)("div",{className:"flex flex-row items-center gap-3 pl-2 text-sm text-zinc-800 dark:text-zinc-50",children:[(0,n.jsx)("div",{className:"text-muted-foreground",children:(0,n.jsx)(w.uO,{})}),(0,n.jsx)("div",{children:"Console"})]}),(0,n.jsx)(k.$,{className:"size-fit p-1 hover:bg-zinc-200 dark:hover:bg-zinc-700",onClick:()=>s([]),size:"icon",variant:"ghost",children:(0,n.jsx)(w.Fj,{})})]}),(0,n.jsxs)("div",{children:[t.map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-row border-zinc-200 border-b bg-zinc-50 px-4 py-2 font-mono text-sm dark:border-zinc-700 dark:bg-zinc-900",children:[(0,n.jsxs)("div",{className:(0,b.cn)("w-12 shrink-0",{"text-muted-foreground":["in_progress","loading_packages"].includes(e.status),"text-emerald-500":"completed"===e.status,"text-red-400":"failed"===e.status}),children:["[",t+1,"]"]}),["in_progress","loading_packages"].includes(e.status)?(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)("div",{className:"mt-0.5 mb-auto size-fit self-center",children:(0,n.jsx)(j.a,{size:16})}),(0,n.jsx)("div",{className:"text-muted-foreground",children:"in_progress"===e.status?"Initializing...":"loading_packages"===e.status?e.contents.map(e=>"text"===e.type?e.value:null):null})]}):(0,n.jsx)("div",{className:"flex w-full flex-col gap-2 overflow-x-scroll text-zinc-900 dark:text-zinc-50",children:e.contents.map((t,s)=>"image"===t.type?(0,n.jsx)("picture",{children:(0,n.jsx)("img",{alt:"output",className:"w-full max-w-(--breakpoint-toast-mobile) rounded-md",src:t.value})},"".concat(e.id,"-").concat(s)):(0,n.jsx)("div",{className:"w-full whitespace-pre-line break-words",children:t.value},"".concat(e.id,"-").concat(s)))})]},e.id)),(0,n.jsx)("div",{ref:l})]})]})]}):null}class C{constructor(e){this.kind=e.kind,this.description=e.description,this.content=e.content,this.actions=e.actions||[],this.toolbar=e.toolbar||[],this.initialize=e.initialize||(async()=>({})),this.onStreamPart=e.onStreamPart}}var S=s(56357);let I={matplotlib:"\n    import io\n    import base64\n    from matplotlib import pyplot as plt\n\n    # Clear any existing plots\n    plt.clf()\n    plt.close('all')\n\n    # Switch to agg backend\n    plt.switch_backend('agg')\n\n    def setup_matplotlib_output():\n        def custom_show():\n            if plt.gcf().get_size_inches().prod() * plt.gcf().dpi ** 2 > 25_000_000:\n                print(\"Warning: Plot size too large, reducing quality\")\n                plt.gcf().set_dpi(100)\n\n            png_buf = io.BytesIO()\n            plt.savefig(png_buf, format='png')\n            png_buf.seek(0)\n            png_base64 = base64.b64encode(png_buf.read()).decode('utf-8')\n            print(f'data:image/png;base64,{png_base64}')\n            png_buf.close()\n\n            plt.clf()\n            plt.close('all')\n\n        plt.show = custom_show\n  ",basic:"\n    # Basic output capture setup\n  "},T=new C({kind:"code",description:"Useful for code generation; Code execution is only available for python code.",initialize:e=>{let{setMetadata:t}=e;t({outputs:[]})},onStreamPart:e=>{let{streamPart:t,setArtifact:s}=e;"codeDelta"===t.type&&s(e=>"string"==typeof t.data?{...e,content:t.data,isVisible:"streaming"===e.status&&e.content.length>300&&e.content.length<310||e.isVisible,status:"streaming"}:e)},content:e=>{let{metadata:t,setMetadata:s,...r}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"px-1",children:(0,n.jsx)(v,{...r})}),(null==t?void 0:t.outputs)&&(0,n.jsx)(N,{consoleOutputs:t.outputs,setConsoleOutputs:()=>{s({...t,outputs:[]})}})]})},actions:[{icon:(0,n.jsx)(w.ud,{size:18}),label:"Run",description:"Execute code",onClick:async e=>{let{content:t,setMetadata:s}=e,n=(0,b.lk)(),r=[];s(e=>({...e,outputs:[...e.outputs,{id:n,contents:[],status:"in_progress"}]}));try{let e=await globalThis.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.23.4/full/"});for(let a of(e.setStdout({batched:e=>{r.push({type:e.startsWith("data:image/png;base64")?"image":"text",value:e})}}),await e.loadPackagesFromImports(t,{messageCallback:e=>{s(t=>({...t,outputs:[...t.outputs.filter(e=>e.id!==n),{id:n,contents:[{type:"text",value:e}],status:"loading_packages"}]}))}}),function(e){let t=["basic"];return(e.includes("matplotlib")||e.includes("plt."))&&t.push("matplotlib"),t}(t)))I[a]&&(await e.runPythonAsync(I[a]),"matplotlib"===a&&await e.runPythonAsync("setup_matplotlib_output()"));await e.runPythonAsync(t),s(e=>({...e,outputs:[...e.outputs.filter(e=>e.id!==n),{id:n,contents:r,status:"completed"}]}))}catch(e){s(t=>({...t,outputs:[...t.outputs.filter(e=>e.id!==n),{id:n,contents:[{type:"text",value:e.message}],status:"failed"}]}))}}},{icon:(0,n.jsx)(w.ej,{size:18}),description:"View Previous version",onClick:e=>{let{handleVersionChange:t}=e;t("prev")},isDisabled:e=>{let{currentVersionIndex:t}=e;return 0===t}},{icon:(0,n.jsx)(w.Uf,{size:18}),description:"View Next version",onClick:e=>{let{handleVersionChange:t}=e;t("next")},isDisabled:e=>{let{isCurrentVersion:t}=e;return!!t}},{icon:(0,n.jsx)(w.Td,{size:18}),description:"Copy code to clipboard",onClick:e=>{let{content:t}=e;navigator.clipboard.writeText(t),c.o.success("Copied to clipboard!")}}],toolbar:[{icon:(0,n.jsx)(w.b1,{}),description:"Add comments",onClick:e=>{let{sendMessage:t}=e;t({role:"user",parts:[{type:"text",text:"Add comments to the code snippet for understanding"}]})}},{icon:(0,n.jsx)(w.Dk,{}),description:"Add logs",onClick:e=>{let{sendMessage:t}=e;t({role:"user",parts:[{type:"text",text:"Add logs to the code snippet for debugging"}]})}}]});var z=s(14058),E=s.n(z);let P=new C({kind:"image",description:"Useful for image generation",onStreamPart:e=>{let{streamPart:t,setArtifact:s}=e;"imageDelta"===t.type&&s(e=>"string"==typeof t.data?{...e,content:t.data,isVisible:!0,status:"streaming"}:e)},content:function(e){let{title:t,content:s,status:r,isInline:a}=e;return(0,n.jsx)("div",{className:E()("flex w-full flex-row items-center justify-center",{"h-[calc(100dvh-60px)]":!a,"h-[200px]":a}),children:"streaming"===r?(0,n.jsxs)("div",{className:"flex flex-row items-center gap-4",children:[!a&&(0,n.jsx)("div",{className:"animate-spin",children:(0,n.jsx)(w.hz,{})}),(0,n.jsx)("div",{children:"Generating Image..."})]}):(0,n.jsx)("picture",{children:(0,n.jsx)("img",{alt:t,className:E()("h-fit w-full max-w-[800px]",{"p-0 md:p-20":!a}),src:"data:image/png;base64,".concat(s)})})})},actions:[{icon:(0,n.jsx)(w.ej,{size:18}),description:"View Previous version",onClick:e=>{let{handleVersionChange:t}=e;t("prev")},isDisabled:e=>{let{currentVersionIndex:t}=e;return 0===t}},{icon:(0,n.jsx)(w.Uf,{size:18}),description:"View Next version",onClick:e=>{let{handleVersionChange:t}=e;t("next")},isDisabled:e=>{let{isCurrentVersion:t}=e;return!!t}},{icon:(0,n.jsx)(w.Td,{size:18}),description:"Copy image to clipboard",onClick:e=>{let{content:t}=e,s=new Image;s.src="data:image/png;base64,".concat(t),s.onload=()=>{let e=document.createElement("canvas");e.width=s.width,e.height=s.height;let t=e.getContext("2d");null==t||t.drawImage(s,0,0),e.toBlob(e=>{e&&navigator.clipboard.write([new ClipboardItem({"image/png":e})])},"image/png")},c.o.success("Copied image to clipboard!")}}],toolbar:[]});var M=s(37068),A=s(93510),R=s(5440);s(70636);let D=(0,d.memo)(e=>{let{content:t,saveContent:s}=e,{resolvedTheme:r}=(0,A.D)(),a=(0,d.useMemo)(()=>{if(!t)return Array(50).fill(Array(26).fill(""));let e=(0,M.parse)(t,{skipEmptyLines:!0}).data.map(e=>{let t=[...e];for(;t.length<26;)t.push("");return t});for(;e.length<50;)e.push(Array(26).fill(""));return e},[t]),i=(0,d.useMemo)(()=>[{key:"rowNumber",name:"",frozen:!0,width:50,renderCell:e=>{let{rowIdx:t}=e;return t+1},cellClass:"border-t border-r dark:bg-zinc-950 dark:text-zinc-50",headerCellClass:"border-t border-r dark:bg-zinc-900 dark:text-zinc-50"},...Array.from({length:26},(e,t)=>({key:t.toString(),name:String.fromCharCode(65+t),renderEditCell:R.jE,width:120,cellClass:(0,b.cn)("border-t dark:bg-zinc-950 dark:text-zinc-50",{"border-l":0!==t}),headerCellClass:(0,b.cn)("border-t dark:bg-zinc-900 dark:text-zinc-50",{"border-l":0!==t})}))],[]),o=(0,d.useMemo)(()=>a.map((e,t)=>{let s={id:t,rowNumber:t+1};return i.slice(1).forEach((t,n)=>{s[t.key]=e[n]||""}),s}),[a,i]),[l,c]=(0,d.useState)(o);(0,d.useEffect)(()=>{c(o)},[o]);let u=e=>(0,M.unparse)(e);return(0,n.jsx)(R.Ay,{className:"dark"===r?"rdg-dark":"rdg-light",columns:i,defaultColumnOptions:{resizable:!0,sortable:!0},enableVirtualization:!0,onCellClick:e=>{"rowNumber"!==e.column.key&&e.selectCell(!0)},onRowsChange:e=>{c(e),s(u(e.map(e=>i.slice(1).map(t=>e[t.key]||""))),!0)},rows:l,style:{height:"100%"}})},function(e,t){return e.currentVersionIndex===t.currentVersionIndex&&e.isCurrentVersion===t.isCurrentVersion&&("streaming"!==e.status||"streaming"!==t.status)&&e.content===t.content&&e.saveContent===t.saveContent}),_=new C({kind:"sheet",description:"Useful for working with spreadsheets",initialize:()=>null,onStreamPart:e=>{let{setArtifact:t,streamPart:s}=e;"sheetDelta"===s.type&&t(e=>"string"==typeof s.data?{...e,content:s.data,isVisible:!0,status:"streaming"}:e)},content:e=>{let{content:t,currentVersionIndex:s,onSaveContent:r,status:a}=e;return(0,n.jsx)(D,{content:t,currentVersionIndex:s,isCurrentVersion:!0,saveContent:r,status:a})},actions:[{icon:(0,n.jsx)(w.ej,{size:18}),description:"View Previous version",onClick:e=>{let{handleVersionChange:t}=e;t("prev")},isDisabled:e=>{let{currentVersionIndex:t}=e;return 0===t}},{icon:(0,n.jsx)(w.Uf,{size:18}),description:"View Next version",onClick:e=>{let{handleVersionChange:t}=e;t("next")},isDisabled:e=>{let{isCurrentVersion:t}=e;return!!t}},{icon:(0,n.jsx)(w.Td,{}),description:"Copy as .csv",onClick:e=>{let{content:t}=e,s=(0,M.parse)(t,{skipEmptyLines:!0}).data.filter(e=>e.some(e=>""!==e.trim())),n=(0,M.unparse)(s);navigator.clipboard.writeText(n),c.o.success("Copied csv to clipboard!")}}],toolbar:[{description:"Format and clean data",icon:(0,n.jsx)(w.BZ,{}),onClick:e=>{let{sendMessage:t}=e;t({role:"user",parts:[{type:"text",text:"Can you please format and clean the data?"}]})}},{description:"Analyze and visualize data",icon:(0,n.jsx)(w.gT,{}),onClick:e=>{let{sendMessage:t}=e;t({role:"user",parts:[{type:"text",text:"Can you please analyze and visualize the data by creating a new code artifact in python?"}]})}}]});var V=s(41907),L=s(97114),F=s(86930),O=s(22296),U=s(50723),q=s(8866),H=s(35297),W=s(3349),B=s(38264);let $={Unchanged:0,Deleted:-1,Inserted:1},K=(e,t,s)=>{et(t,s);let n=[],r=[],a=er(t),i=er(s),o=a.length,l=i.length,d=Math.min(o,l),c=0,u=0;for(;c<d;c++){let e=a[c];if(!en(e,i[c]))break;n.push(...es(e))}for(;u+c+1<d;u++){let e=a[o-u-1];if(!en(e,i[l-u-1]))break;r.unshift(...es(e))}let m=a.slice(c,o-u),p=i.slice(c,l-u);if(m.length&&p.length){let t=Z(e,m,p).sort((e,t)=>t.count-e.count)[0];if(t){let{oldStartIndex:s,newStartIndex:a,oldEndIndex:i,newEndIndex:o}=t,l=m.slice(0,s),d=p.slice(0,a);n.push(...G(e,l,d)),n.push(...m.slice(s,i));let c=m.slice(i),u=p.slice(o);r.unshift(...G(e,c,u))}else n.push(...G(e,m,p))}else n.push(...G(e,m,p));return em(t,[...n,...r])},Z=(e,t,s)=>{let n=[];for(let e=0;e<t.length;e++){let r=J(s,t[e]);if(-1!==r){let a=e+1,i=r+1;for(;a<t.length&&i<s.length;a++,i++){let e=t[a];if(!en(s[i],e))break}n.push({oldStartIndex:e,newStartIndex:r,oldEndIndex:a,newEndIndex:i,count:i-r})}}return n},J=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let n=s;n<e.length;n++)if(en(e[n],t))return n;return -1},G=(e,t,s)=>{let n=[],r=[],a=t.length,i=s.length,o=0,l=0;for(;a-o-l>0&&i-o-l>0;){let d=t[o],c=s[o],u=t[a-l-1],m=s[i-l-1],p=!ec(d)&&eu(d,c),f=!ec(u)&&eu(u,m);if(Array.isArray(d)&&Array.isArray(c)){n.push(...Q(e,d,c)),o+=1;continue}p&&f&&(ee(d,c)<ee(u,m)?p=!1:f=!1),p?(n.push(K(e,d,c)),o+=1):f?(r.unshift(K(e,u,m)),l+=1):(n.push(ep(e,d,$.Deleted)),n.push(ep(e,c,$.Inserted)),o+=1)}let d=a-o-l,c=i-o-l;return d&&n.push(...t.slice(o,o+d).flat().map(t=>ep(e,t,$.Deleted))),c&&r.unshift(...s.slice(o,o+c).flat().map(t=>ep(e,t,$.Inserted))),[...n,...r]},Q=(e,t,s)=>{let n=new B.diff_match_patch,r=t.map(e=>ed(e)).join(""),a=s.map(e=>ed(e)).join(""),{chars1:i,chars2:o,lineArray:l}=X(Y(r),Y(a)),d=n.diff_main(i,o,!1);return(d=d.map(e=>{let[t,s]=e;return[t,s.split("").map(e=>l[e.charCodeAt(0)])]})).flatMap(t=>{let[s,n]=t;return n.map(t=>eh(e,t,s!==$.Unchanged?[ef(e,s)]:[]))})},Y=e=>e.match(/[^.!?]+[.!?]*\s*/g)||[],X=(e,t)=>{let s=[],n={},r=0;return{chars1:e.map(e=>(e in n||(n[e]=r,s[r]=e,r++),String.fromCharCode(n[e]))).join(""),chars2:t.map(e=>(e in n||(n[e]=r,s[r]=e,r++),String.fromCharCode(n[e]))).join(""),lineArray:s}},ee=(e,t)=>0,et=(e,t)=>{if(ea(e,"type")!==ea(t,"type"))throw Error("node type not equal: ".concat(e.type," !== ").concat(t.type))},es=e=>Array.isArray(e)?e:[e],en=(e,t)=>{let s=Array.isArray(e);if(s!==Array.isArray(t))return!1;if(s)return e.length===t.length&&e.every((e,s)=>en(e,t[s]));if(ea(e,"type")!==ea(t,"type"))return!1;if(ec(e)&&ea(e,"text")!==ea(t,"text"))return!1;let n=ei(e),r=ei(t);for(let e of[...new Set([...Object.keys(n),...Object.keys(r)])])if(n[e]!==r[e])return!1;let a=eo(e),i=eo(t);if(a.length!==i.length)return!1;for(let e=0;e<a.length;e++)if(!en(a[e],i[e]))return!1;let o=el(e),l=el(t);if(o.length!==l.length)return!1;for(let e=0;e<o.length;e++)if(!en(o[e],l[e]))return!1;return!0},er=e=>{var t;let s=null!=(t=el(e))?t:[],n=[];for(let e=0;e<s.length;e++){let t=s[e];if(ec(t)){let t=[];for(let n=s[e];e<s.length&&ec(n);n=s[++e])t.push(n);e--,n.push(t)}else n.push(t)}return n},ea=(e,t)=>{if("type"===t){var s;return null==(s=e.type)?void 0:s.name}return e[t]},ei=e=>e.attrs?e.attrs:{},eo=e=>{var t;return null!=(t=e.marks)?t:[]},el=e=>{var t,s;return null!=(s=null==(t=e.content)?void 0:t.content)?s:[]},ed=e=>e.text,ec=e=>{var t;return(null==(t=e.type)?void 0:t.name)==="text"},eu=(e,t)=>{var s,n;return(null==(s=e.type)?void 0:s.name)===(null==(n=t.type)?void 0:n.name)||Array.isArray(e)&&Array.isArray(t)},em=(e,t)=>{if(!e.type)throw Error("oldNode.type is undefined");return new L.bP(e.type,e.attrs,L.FK.fromArray(t),e.marks)},ep=(e,t,s)=>(function e(t,s){let n=t.copy(L.FK.from(t.content.content.map(t=>e(t,s)).filter(e=>e)));return s(n)||n})(t,t=>ec(t)?eh(e,ed(t),[...t.marks||[],ef(e,s)]):t),ef=(e,t)=>{if(t===$.Inserted||t===$.Deleted)return e.mark("diffMark",{type:t});throw Error("type is not valid")},eh=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.text(t,s)},eg=(e,t,s)=>{let n=L.bP.fromJSON(e,t),r=L.bP.fromJSON(e,s);return K(e,n,r)},ex=new L.Sj({nodes:(0,O.ZW)(F.wQ.spec.nodes,"paragraph block*","block"),marks:V.A.from({...F.wQ.spec.marks.toObject(),diffMark:{attrs:{type:{default:""}},toDOM(e){let t="";switch(e.attrs.type){case $.Inserted:t="bg-green-100 text-green-700 dark:bg-green-500/70 dark:text-green-300";break;case $.Deleted:t="bg-red-100 line-through text-red-600 dark:bg-red-500/70 dark:text-red-300";break;default:t=""}return["span",{class:t},0]}}})}),ev=e=>{let{oldContent:t,newContent:s}=e,r=(0,d.useRef)(null),a=(0,d.useRef)(null);return(0,d.useEffect)(()=>{if(r.current&&!a.current){let e=L.S4.fromSchema(ex),i=(0,H.F0)((0,n.jsx)(W.jH,{children:t})),o=(0,H.F0)((0,n.jsx)(W.jH,{children:s})),l=document.createElement("div");l.innerHTML=i;let d=document.createElement("div");d.innerHTML=o;let c=e.parse(l),u=e.parse(d),m=eg(ex,c.toJSON(),u.toJSON()),p=U.$t.create({doc:m,plugins:[]});a.current=new q.Lz(r.current,{state:p,editable:()=>!1})}return()=>{a.current&&(a.current.destroy(),a.current=null)}},[t,s]),(0,n.jsx)("div",{className:"diff-editor",ref:r})},ey=e=>{let{artifactKind:t}=e;return"image"===t?(0,n.jsx)("div",{className:"flex h-[calc(100dvh-60px)] w-full flex-col items-center justify-center gap-4",children:(0,n.jsx)("div",{className:"size-96 animate-pulse rounded-lg bg-muted-foreground/20"})}):(0,n.jsxs)("div",{className:"flex w-full flex-col gap-4",children:[(0,n.jsx)("div",{className:"h-12 w-1/2 animate-pulse rounded-lg bg-muted-foreground/20"}),(0,n.jsx)("div",{className:"h-5 w-full animate-pulse rounded-lg bg-muted-foreground/20"}),(0,n.jsx)("div",{className:"h-5 w-full animate-pulse rounded-lg bg-muted-foreground/20"}),(0,n.jsx)("div",{className:"h-5 w-1/3 animate-pulse rounded-lg bg-muted-foreground/20"}),(0,n.jsx)("div",{className:"h-5 w-52 animate-pulse rounded-lg bg-transparent"}),(0,n.jsx)("div",{className:"h-8 w-52 animate-pulse rounded-lg bg-muted-foreground/20"}),(0,n.jsx)("div",{className:"h-5 w-2/3 animate-pulse rounded-lg bg-muted-foreground/20"})]})};var eb=s(32966),ej=s(88584),ew=s(77360),ek=s(59278),eN=s(25659);let eC=e=>{let{suggestion:t,onApply:s,artifactKind:r}=e,[a,i]=(0,d.useState)(!1),{width:c}=(0,m.lW)();return(0,n.jsx)(o.N,{children:a?(0,n.jsxs)(l.P.div,{animate:{opacity:1,y:-20},className:"-right-12 md:-right-16 absolute z-50 flex w-56 flex-col gap-3 rounded-lg border bg-background p-3 font-sans text-sm shadow-xl",exit:{opacity:0,y:-10},initial:{opacity:0,y:-10},transition:{type:"spring",stiffness:500,damping:30},whileHover:{scale:1.05},children:[(0,n.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,n.jsx)("div",{className:"size-4 rounded-lg bg-muted-foreground/25"}),(0,n.jsx)("div",{className:"font-medium",children:"Assistant"})]}),(0,n.jsx)("button",{className:"cursor-pointer text-gray-500 text-xs",onClick:()=>{i(!1)},type:"button",children:(0,n.jsx)(w.w0,{size:12})})]}),(0,n.jsx)("div",{children:t.content}),(0,n.jsx)(k.$,{className:"w-fit rounded-lg px-3 py-1.5",onClick:s,variant:"outline",children:"Apply"})]},t.id):(0,n.jsx)(l.P.div,{className:(0,b.cn)("cursor-pointer p-1 text-muted-foreground",{"-right-8 absolute":"text"===r,"sticky top-0 right-4":"code"===r}),onClick:()=>{i(!0)},whileHover:{scale:1.1},children:(0,n.jsx)(w.b1,{size:c&&c<768?16:14})})})},eS=new U.hs("suggestions"),eI=new U.k_({key:eS,state:{init:()=>({decorations:q.zF.empty,selected:null}),apply(e,t){let s=e.getMeta(eS);return s||{decorations:t.decorations.map(e.mapping,e.doc),selected:t.selected}}},props:{decorations(e){var t,s;return null!=(s=null==(t=this.getState(e))?void 0:t.decorations)?s:q.zF.empty}}}),eT=e=>{let t=L.S4.fromSchema(eP),s=(0,H.F0)((0,n.jsx)(ek.Y,{children:e})),r=document.createElement("div");return r.innerHTML=s,t.parse(r)},ez=e=>ew.lR.serialize(e),eE=(e,t)=>{let s=[];for(let t of e)s.push(q.NZ.inline(t.selectionStart,t.selectionEnd,{class:"suggestion-highlight"},{suggestionId:t.id,type:"highlight"})),s.push(q.NZ.widget(t.selectionStart,e=>{let{dom:s}=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",r=document.createElement("span"),a=(0,eN.createRoot)(r);return r.addEventListener("mousedown",e=>{e.preventDefault(),t.dom.blur()}),a.render((0,n.jsx)(eC,{artifactKind:s,onApply:()=>{let{state:s,dispatch:n}=t,r=s.tr,a=eS.getState(s),i=null==a?void 0:a.decorations;if(i){let t=q.zF.create(s.doc,i.find().filter(t=>t.spec.suggestionId!==e.id));r.setMeta(eS,{decorations:t,selected:null}),n(r)}let o=t.state.tr.replaceWith(e.selectionStart,e.selectionEnd,s.schema.text(e.content));o.setMeta("no-debounce",!0),n(o)},suggestion:e})),{dom:r,destroy:()=>{setTimeout(()=>{a.unmount()},0)}}}(t,e);return s},{suggestionId:t.id,type:"widget"}));return q.zF.create(t.state.doc,s)},eP=new L.Sj({nodes:(0,O.ZW)(F.wQ.spec.nodes,"paragraph block*","block"),marks:F.wQ.spec.marks});function eM(e){return(0,ej.JJ)(new RegExp("^(#{1,".concat(e,"})\\s$")),eP.nodes.heading,()=>({level:e}))}let eA=e=>{let{transaction:t,editorRef:s,onSaveContent:n}=e;if(!s||!s.current)return;let r=s.current.state.apply(t);s.current.updateState(r),t.docChanged&&!t.getMeta("no-save")&&n(ez(r.doc),!t.getMeta("no-debounce"))},eR=(0,d.memo)(function(e){let{content:t,onSaveContent:s,suggestions:r,status:a}=e,i=(0,d.useRef)(null),o=(0,d.useRef)(null);return(0,d.useEffect)(()=>{if(i.current&&!o.current){let e=U.$t.create({doc:eT(t),plugins:[...(0,eb.WX)({schema:eP,menuBar:!1}),(0,ej.sM)({rules:[eM(1),eM(2),eM(3),eM(4),eM(5),eM(6)]}),eI]});o.current=new q.Lz(i.current,{state:e})}return()=>{o.current&&(o.current.destroy(),o.current=null)}},[t]),(0,d.useEffect)(()=>{o.current&&o.current.setProps({dispatchTransaction:e=>{eA({transaction:e,editorRef:o,onSaveContent:s})}})},[s]),(0,d.useEffect)(()=>{if(o.current&&t){let e=ez(o.current.state.doc);if("streaming"===a){let e=eT(t),s=o.current.state.tr.replaceWith(0,o.current.state.doc.content.size,e.content);s.setMeta("no-save",!0),o.current.dispatch(s);return}if(e!==t){let e=eT(t),s=o.current.state.tr.replaceWith(0,o.current.state.doc.content.size,e.content);s.setMeta("no-save",!0),o.current.dispatch(s)}}},[t,a]),(0,d.useEffect)(()=>{var e,s;if((null==(e=o.current)?void 0:e.state.doc)&&t){let e=eE((s=o.current.state.doc,r.map(e=>{var t;let n,r=(t=e.content,n=null,s.nodesBetween(0,s.content.size,(e,s)=>{if(e.isText&&e.text){let r=e.text.indexOf(t);if(-1!==r)return n={start:s+r,end:s+r+t.length},!1}return!0}),n);return r?{...e,selectionStart:r.start,selectionEnd:r.end}:{...e,selectionStart:0,selectionEnd:0}})).filter(e=>e.selectionStart&&e.selectionEnd),o.current),t=o.current.state.tr;t.setMeta(eS,{decorations:e}),o.current.dispatch(t)}},[r,t]),(0,n.jsx)("div",{className:"prose dark:prose-invert relative",ref:i})},function(e,t){return e.suggestions===t.suggestions&&e.currentVersionIndex===t.currentVersionIndex&&e.isCurrentVersion===t.isCurrentVersion&&("streaming"!==e.status||"streaming"!==t.status)&&e.content===t.content&&e.onSaveContent===t.onSaveContent});var eD=s(91639);let e_=new C({kind:"text",description:"Useful for text content, like drafting essays and emails.",initialize:async e=>{let{documentId:t,setMetadata:s}=e;s({suggestions:await (0,eD.KW)({documentId:t})})},onStreamPart:e=>{let{streamPart:t,setMetadata:s,setArtifact:n}=e;"textDelta"===t.type&&n(e=>"string"==typeof t.data?{...e,content:e.content+t.data,isVisible:"streaming"===e.status&&e.content.length>400&&e.content.length<450||e.isVisible,status:"streaming"}:e)},content:e=>{let{mode:t,status:s,content:r,isCurrentVersion:a,currentVersionIndex:i,onSaveContent:o,getDocumentContentById:l,isLoading:d,metadata:c}=e;if(d)return(0,n.jsx)(ey,{artifactKind:"text"});if("diff"===t){let e=l(i-1),t=l(i);return(0,n.jsx)(ev,{newContent:t,oldContent:e})}return(0,n.jsxs)("div",{className:"flex flex-row px-4 py-8 md:p-20",children:[(0,n.jsx)(eR,{content:r,currentVersionIndex:i,isCurrentVersion:a,onSaveContent:o,status:s,suggestions:c?c.suggestions:[]}),(null==c?void 0:c.suggestions)&&c.suggestions.length>0?(0,n.jsx)("div",{className:"h-dvh w-12 shrink-0 md:hidden"}):null]})},actions:[{icon:(0,n.jsx)(w.Qe,{size:18}),description:"View changes",onClick:e=>{let{handleVersionChange:t}=e;t("toggle")},isDisabled:e=>{let{currentVersionIndex:t}=e;return 0===t}},{icon:(0,n.jsx)(w.ej,{size:18}),description:"View Previous version",onClick:e=>{let{handleVersionChange:t}=e;t("prev")},isDisabled:e=>{let{currentVersionIndex:t}=e;return 0===t}},{icon:(0,n.jsx)(w.Uf,{size:18}),description:"View Next version",onClick:e=>{let{handleVersionChange:t}=e;t("next")},isDisabled:e=>{let{isCurrentVersion:t}=e;return!!t}},{icon:(0,n.jsx)(w.Td,{size:18}),description:"Copy to clipboard",onClick:e=>{let{content:t}=e;navigator.clipboard.writeText(t),c.o.success("Copied to clipboard!")}}],toolbar:[{icon:(0,n.jsx)(w.rZ,{}),description:"Add final polish",onClick:e=>{let{sendMessage:t}=e;t({role:"user",parts:[{type:"text",text:"Please add final polish and check for grammar, add section titles for better structure, and ensure everything reads smoothly."}]})}},{icon:(0,n.jsx)(w.b1,{}),description:"Request suggestions",onClick:e=>{let{sendMessage:t}=e;t({role:"user",parts:[{type:"text",text:"Please add suggestions you have that could improve the writing."}]})}}]});var eV=s(98120),eL=s(97229),eF=s(83415);class eO{async getDocument(e){try{let t=(0,eV.F6)();if(!t)throw new eL.P7("unauthorized:document");let s=await (0,eF._L)(e);if(!s)throw new eL.P7("not_found:document");if(s.userId!==t)throw new eL.P7("forbidden:document");return[s]}catch(e){if(e instanceof eL.P7)throw e;throw new eL.P7("bad_request:document","Failed to get document: ".concat(e instanceof Error?e.message:"Unknown error"))}}async saveDocument(e){try{let t=(0,eV.F6)();if(!t)throw new eL.P7("unauthorized:document");let s=await (0,eF._L)(e.id);if(s&&s.userId!==t)throw new eL.P7("forbidden:document");return await (0,eF.bd)({id:e.id,content:e.content,title:e.title,kind:e.kind,userId:t})}catch(e){if(e instanceof eL.P7)throw e;throw new eL.P7("bad_request:document","Failed to save document: ".concat(e instanceof Error?e.message:"Unknown error"))}}async deleteDocument(e,t){return await Promise.resolve(),{deletedCount:0}}}let eU=new eO;var eq=s(23625);let eH=(0,d.memo)(function(e){let{artifact:t,handleVersionChange:s,currentVersionIndex:r,isCurrentVersion:a,mode:i,metadata:o,setMetadata:l}=e,[u,m]=(0,d.useState)(!1),p=e6.find(e=>e.kind===t.kind);if(!p)throw Error("Artifact definition not found!");let f={content:t.content,handleVersionChange:s,currentVersionIndex:r,isCurrentVersion:a,mode:i,metadata:o,setMetadata:l};return(0,n.jsx)("div",{className:"flex flex-row gap-1",children:p.actions.map(e=>(0,n.jsxs)(eq.m_,{children:[(0,n.jsx)(eq.k$,{asChild:!0,children:(0,n.jsxs)(k.$,{className:(0,b.cn)("h-fit dark:hover:bg-zinc-700",{"p-2":!e.label,"px-2 py-1.5":e.label}),disabled:!!u||"streaming"===t.status||!!e.isDisabled&&e.isDisabled(f),onClick:async()=>{m(!0);try{await Promise.resolve(e.onClick(f))}catch(e){c.o.error("Failed to execute action")}finally{m(!1)}},variant:"outline",children:[e.icon,e.label]})}),(0,n.jsx)(eq.ZI,{children:e.description})]},e.description))})},(e,t)=>e.artifact.status===t.artifact.status&&e.currentVersionIndex===t.currentVersionIndex&&e.isCurrentVersion===t.isCurrentVersion&&e.artifact.content===t.artifact.content),eW=(0,d.memo)(function(){let{setArtifact:e}=(0,y.ST)();return(0,n.jsx)(k.$,{className:"h-fit p-2 dark:hover:bg-zinc-700","data-testid":"artifact-close-button",onClick:()=>{e(e=>"streaming"===e.status?{...e,isVisible:!1}:{...y.ls,status:"idle"})},variant:"outline",children:(0,n.jsx)(w.w0,{size:18})})},()=>!0);var eB=s(40827),e$=s(94456);let eK=(0,d.memo)(function(e){let{chatId:t,status:s,votes:r,messages:a,setMessages:i,regenerate:d,isReadonly:c}=e,{containerRef:u,endRef:m,onViewportEnter:p,onViewportLeave:f,hasSentMessage:h}=(0,eB.o)({status:s});return(0,n.jsxs)("div",{className:"flex h-full flex-col items-center gap-4 overflow-y-scroll px-4 pt-20",ref:u,children:[a.map((e,o)=>(0,n.jsx)(e$.e,{chatId:t,isLoading:"streaming"===s&&o===a.length-1,isReadonly:c,message:e,regenerate:d,requiresScrollPadding:h&&o===a.length-1,setMessages:i,vote:r?r.find(t=>t.messageId===e.id):void 0},e.id)),(0,n.jsx)(o.N,{mode:"wait",children:"submitted"===s&&(0,n.jsx)(e$.q,{},"thinking")}),(0,n.jsx)(l.P.div,{className:"min-h-[24px] min-w-[24px] shrink-0",onViewportEnter:p,onViewportLeave:f,ref:m})]})},function(e,t){return"streaming"===e.artifactStatus&&"streaming"===t.artifactStatus||e.status===t.status&&(!e.status||!t.status)&&e.messages.length===t.messages.length&&!!i()(e.votes,t.votes)});var eZ=s(19564),eJ=s(43275),eG=s(72843),eQ=s(2109);let eY=e=>{let{description:t,icon:s,selectedTool:r,setSelectedTool:a,isToolbarVisible:i,setIsToolbarVisible:o,isAnimating:c,sendMessage:u,onClick:m}=e,[p,f]=(0,d.useState)(!1);(0,d.useEffect)(()=>{r!==t&&f(!1)},[r,t]);let h=()=>{if(!i&&o)return void o(!0);if(!r){f(!0),a(t);return}r!==t?a(t):(a(null),m({sendMessage:u}))};return(0,n.jsxs)(eq.m_,{open:p&&!c,children:[(0,n.jsx)(eq.k$,{asChild:!0,children:(0,n.jsx)(l.P.div,{animate:{opacity:1,transition:{delay:.1}},className:E()("rounded-full p-3",{"bg-primary text-primary-foreground!":r===t}),exit:{scale:.9,opacity:0,transition:{duration:.1}},initial:{scale:1,opacity:0},onClick:()=>{h()},onHoverEnd:()=>{r!==t&&f(!1)},onHoverStart:()=>{f(!0)},onKeyDown:e=>{"Enter"===e.key&&h()},whileHover:{scale:1.1},whileTap:{scale:.95},children:r===t?(0,n.jsx)(w.Kp,{}):s})}),(0,n.jsx)(eq.ZI,{className:"rounded-2xl bg-foreground p-3 px-4 text-background",side:"left",sideOffset:16,children:t})]})},eX=[...Array(6)].map(e=>(0,eQ.Ak)(5)),e0=e=>{let{setSelectedTool:t,sendMessage:s,isAnimating:r}=e,a=["Elementary","Middle School","Keep current level","High School","College","Graduate"],i=(0,eJ.d)(-80),o=(0,eG.G)(i,[0,-202],[0,5]),[c,u]=(0,d.useState)(2),[m,p]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{let e=o.on("change",e=>{u(Math.min(5,Math.max(0,Math.round(Math.abs(e)))))});return()=>e()},[o]),(0,n.jsxs)("div",{className:"relative flex flex-col items-center justify-end",children:[eX.map(e=>(0,n.jsx)(l.P.div,{animate:{opacity:1},className:"flex size-[40px] flex-row items-center justify-center",exit:{opacity:0},initial:{opacity:0},transition:{delay:.1},children:(0,n.jsx)("div",{className:"size-2 rounded-full bg-muted-foreground/40"})},e)),(0,n.jsx)(eq.Bc,{children:(0,n.jsxs)(eq.m_,{open:!r,children:[(0,n.jsx)(eq.k$,{asChild:!0,children:(0,n.jsx)(l.P.div,{className:E()("absolute flex flex-row items-center rounded-full border bg-background p-3",{"bg-primary text-primary-foreground":2!==c,"bg-background text-foreground":2===c}),drag:"y",dragConstraints:{top:-202,bottom:0},dragElastic:0,dragMomentum:!1,onClick:()=>{2!==c&&m&&(s({role:"user",parts:[{type:"text",text:"Please adjust the reading level to ".concat(a[c]," level.")}]}),t(null))},onDragEnd:()=>{2===c?t(null):p(!0)},onDragStart:()=>{p(!1)},style:{y:i},transition:{duration:.1},whileHover:{scale:1.05},whileTap:{scale:.95},children:2===c?(0,n.jsx)(w.hD,{}):(0,n.jsx)(w.Kp,{})})}),(0,n.jsx)(eq.ZI,{className:"rounded-2xl bg-foreground p-3 px-4 text-background text-sm",side:"left",sideOffset:16,children:a[c]})]})})]})},e1=e=>{let{isToolbarVisible:t,selectedTool:s,setSelectedTool:r,sendMessage:a,isAnimating:i,setIsToolbarVisible:d,tools:c}=e,[u,...m]=c;return(0,n.jsxs)(l.P.div,{animate:{opacity:1,scale:1},className:"flex flex-col gap-1.5",exit:{opacity:0,scale:.95},initial:{opacity:0,scale:.95},children:[(0,n.jsx)(o.N,{children:t&&m.map(e=>(0,n.jsx)(eY,{description:e.description,icon:e.icon,isAnimating:i,onClick:e.onClick,selectedTool:s,sendMessage:a,setSelectedTool:r},e.description))}),(0,n.jsx)(eY,{description:u.description,icon:u.icon,isAnimating:i,isToolbarVisible:t,onClick:u.onClick,selectedTool:s,sendMessage:a,setIsToolbarVisible:d,setSelectedTool:r})]})},e2=(0,d.memo)(e=>{let{isToolbarVisible:t,setIsToolbarVisible:s,sendMessage:r,status:a,stop:i,setMessages:o,artifactKind:c}=e,u=(0,d.useRef)(null),p=(0,d.useRef)(),[f,h]=(0,d.useState)(null),[g,x]=(0,d.useState)(!1);(0,m.Wr)(u,()=>{s(!1),h(null)});let v=()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{h(null),s(!1)},2e3)},y=()=>{p.current&&clearTimeout(p.current)};(0,d.useEffect)(()=>()=>{p.current&&clearTimeout(p.current)},[]),(0,d.useEffect)(()=>{"streaming"===a&&s(!1)},[a,s]);let b=e6.find(e=>e.kind===c);if(!b)throw Error("Artifact definition not found!");let j=b.toolbar;return 0===j.length?null:(0,n.jsx)(eq.Bc,{delayDuration:0,children:(0,n.jsx)(l.P.div,{animate:t?"adjust-reading-level"===f?{opacity:1,y:0,height:258,transition:{delay:0},scale:.95}:{opacity:1,y:0,height:50*j.length,transition:{delay:0},scale:1}:{opacity:1,y:0,height:54,transition:{delay:0}},className:"absolute right-6 bottom-6 flex cursor-pointer flex-col justify-end rounded-full border bg-background p-1.5 shadow-lg",exit:{opacity:0,y:-20,transition:{duration:.1}},initial:{opacity:0,y:-20,scale:1},onAnimationComplete:()=>{x(!1)},onAnimationStart:()=>{x(!0)},onHoverEnd:()=>{"streaming"!==a&&v()},onHoverStart:()=>{"streaming"!==a&&(y(),s(!0))},ref:u,transition:{type:"spring",stiffness:300,damping:25},children:"streaming"===a?(0,n.jsx)(l.P.div,{animate:{scale:1.4},className:"p-3",exit:{scale:1},initial:{scale:1},onClick:()=>{i(),o(e=>[...e])},children:(0,n.jsx)(w.wF,{})},"stop-icon"):"adjust-reading-level"===f?(0,n.jsx)(e0,{isAnimating:g,sendMessage:r,setSelectedTool:h},"reading-level-selector"):(0,n.jsx)(e1,{isAnimating:g,isToolbarVisible:t,selectedTool:f,sendMessage:r,setIsToolbarVisible:s,setSelectedTool:h,tools:j},"tools")})})},(e,t)=>e.status===t.status&&e.isToolbarVisible===t.isToolbarVisible&&e.artifactKind===t.artifactKind);var e5=s(59145),e4=s(41799);let e3=e=>{let{handleVersionChange:t,documents:s,currentVersionIndex:r}=e,{artifact:a}=(0,y.ST)(),{width:i}=(0,m.lW)(),o=i<768,{mutate:p}=(0,u.iX)(),[f,h]=(0,d.useState)(!1);if(s)return(0,n.jsxs)(l.P.div,{animate:{y:0},className:"absolute bottom-0 z-50 flex w-full flex-col justify-between gap-4 border-t bg-background p-4 lg:flex-row",exit:{y:o?200:77},initial:{y:o?200:77},transition:{type:"spring",stiffness:140,damping:20},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:"You are viewing a previous version"}),(0,n.jsx)("div",{className:"text-muted-foreground text-sm",children:"Restore this version to make edits"})]}),(0,n.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,n.jsxs)(k.$,{disabled:f,onClick:async()=>{h(!0);try{await eU.deleteDocument(a.documentId,(0,b.Dn)(s,r).toISOString()),s&&s.filter(e=>(0,e4.d)(new Date(e.createdAt),new Date((0,b.Dn)(s,r)))),c.o.success("Version restored successfully")}catch(e){console.error("Failed to restore version:",e),c.o.error("Failed to restore version")}finally{h(!1)}},children:[(0,n.jsx)("div",{children:"Restore this version"}),f&&(0,n.jsx)("div",{className:"animate-spin",children:(0,n.jsx)(w.hz,{})})]}),(0,n.jsx)(k.$,{onClick:()=>{t("latest")},variant:"outline",children:"Back to latest version"})]})]})},e6=[e_,T,P,_],e8=(0,d.memo)(function(e){let{chatId:t,input:a,setInput:i,status:p,stop:f,attachments:h,setAttachments:g,sendMessage:x,messages:v,setMessages:b,regenerate:j,votes:w,isReadonly:k,selectedModelId:N}=e,{artifact:C,setArtifact:S,metadata:I,setMetadata:T}=(0,y.ST)(),[z,E]=(0,d.useState)(void 0),[P,M]=(0,d.useState)(!1);(0,d.useEffect)(()=>{(async()=>{if("init"===C.documentId||"streaming"===C.status)return E(void 0);M(!0);try{let e=await eU.getDocument(C.documentId);E(e||void 0)}catch(e){console.error("Failed to fetch document:",e),E(void 0)}finally{M(!1)}})()},[C.documentId,C.status]);let[A,R]=(0,d.useState)("edit"),[D,_]=(0,d.useState)(null),[V,L]=(0,d.useState)(-1),{open:F}=(0,e5.cL)();(0,d.useEffect)(()=>{if(z&&z.length>0){let e=z.at(-1);e&&(_(e),L(z.length-1),S(t=>{var s;return{...t,content:null!=(s=e.content)?s:""}}))}},[z,S]);let{mutate:O}=(0,u.iX)(),[U,q]=(0,d.useState)(!1),H=(0,d.useCallback)(e=>{C&&O(["document",C.documentId],async t=>{if(!t)return[];let n=t.at(-1);if(!n||!n.content)return q(!1),t;if(n.content!==e)try{let{clientDbService:r}=await s.e(4232).then(s.bind(s,14232));await r.saveDocument({id:C.documentId,title:C.title,content:e,kind:C.kind,userId:""}),q(!1);let a={...n,content:e,createdAt:new Date};return[...t,a]}catch(e){console.error("Failed to save document:",e),c.o.error("Failed to save document")}return t},{revalidate:!1})},[C,O]),W=(0,m._6)(H,2e3),B=(0,d.useCallback)((e,t)=>{D&&e!==D.content&&(q(!0),t?W(e):H(e))},[D,W,H]);function $(e){var t;return z&&z[e]&&null!=(t=z[e].content)?t:""}let K=e=>{z&&("latest"===e&&(L(z.length-1),R("edit")),"toggle"===e&&R(e=>"edit"===e?"diff":"edit"),"prev"===e?V>0&&L(e=>e-1):"next"===e&&V<z.length-1&&L(e=>e+1))},[Z,J]=(0,d.useState)(!1),G=!z||!(z.length>0)||V===z.length-1,{width:Q,height:Y}=(0,m.lW)(),X=!!Q&&Q<768,ee=e6.find(e=>e.kind===C.kind);if(!ee)throw Error("Artifact definition not found!");return(0,d.useEffect)(()=>{"init"!==C.documentId&&ee.initialize&&ee.initialize({documentId:C.documentId,setMetadata:T})},[C.documentId,ee,T]),(0,n.jsx)(o.N,{children:C.isVisible&&(0,n.jsxs)(l.P.div,{animate:{opacity:1},className:"fixed top-0 left-0 z-50 flex h-dvh w-dvw flex-row bg-transparent","data-testid":"artifact",exit:{opacity:0,transition:{delay:.4}},initial:{opacity:1},children:[!X&&(0,n.jsx)(l.P.div,{animate:{width:Q,right:0},className:"fixed h-dvh bg-background",exit:{width:F?Q-256:Q,right:0},initial:{width:F?Q-256:Q,right:0}}),!X&&(0,n.jsxs)(l.P.div,{animate:{opacity:1,x:0,scale:1,transition:{delay:.1,type:"spring",stiffness:300,damping:30}},className:"relative h-dvh w-[400px] shrink-0 bg-muted dark:bg-background",exit:{opacity:0,x:0,scale:1,transition:{duration:0}},initial:{opacity:0,x:10,scale:1},children:[(0,n.jsx)(o.N,{children:!G&&(0,n.jsx)(l.P.div,{animate:{opacity:1},className:"absolute top-0 left-0 z-50 h-dvh w-[400px] bg-zinc-900/50",exit:{opacity:0},initial:{opacity:0}})}),(0,n.jsxs)("div",{className:"flex h-full flex-col items-center justify-between",children:[(0,n.jsx)(eK,{artifactStatus:C.status,chatId:t,isReadonly:k,messages:v,regenerate:j,setMessages:b,status:p,votes:w}),(0,n.jsx)("div",{className:"relative flex w-full flex-row items-end gap-2 px-4 pb-4",children:(0,n.jsx)(eZ.Z,{attachments:h,chatId:t,className:"bg-background dark:bg-muted",input:a,messages:v,selectedModelId:N,sendMessage:x,setAttachments:g,setInput:i,setMessages:b,status:p,stop:f})})]})]}),(0,n.jsxs)(l.P.div,{animate:X?{opacity:1,x:0,y:0,height:Y,width:Q||"calc(100dvw)",borderRadius:0,transition:{delay:0,type:"spring",stiffness:300,damping:30,duration:.8}}:{opacity:1,x:400,y:0,height:Y,width:Q?Q-400:"calc(100dvw-400px)",borderRadius:0,transition:{delay:0,type:"spring",stiffness:300,damping:30,duration:.8}},className:"fixed flex h-dvh flex-col overflow-y-scroll border-zinc-200 bg-background md:border-l dark:border-zinc-700 dark:bg-muted",exit:{opacity:0,scale:.5,transition:{delay:.1,type:"spring",stiffness:600,damping:30}},initial:{opacity:1,x:C.boundingBox.left,y:C.boundingBox.top,height:C.boundingBox.height,width:C.boundingBox.width,borderRadius:50},children:[(0,n.jsxs)("div",{className:"flex flex-row items-start justify-between p-2",children:[(0,n.jsxs)("div",{className:"flex flex-row items-start gap-4",children:[(0,n.jsx)(eW,{}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("div",{className:"font-medium",children:C.title}),U?(0,n.jsx)("div",{className:"text-muted-foreground text-sm",children:"Saving changes..."}):D?(0,n.jsx)("div",{className:"text-muted-foreground text-sm",children:"Updated ".concat((0,r.B)(new Date(D.createdAt),new Date,{addSuffix:!0}))}):(0,n.jsx)("div",{className:"mt-2 h-3 w-32 animate-pulse rounded-md bg-muted-foreground/20"})]})]}),(0,n.jsx)(eH,{artifact:C,currentVersionIndex:V,handleVersionChange:K,isCurrentVersion:G,metadata:I,mode:A,setMetadata:T})]}),(0,n.jsxs)("div",{className:"h-full max-w-full! items-center overflow-y-scroll bg-background dark:bg-muted",children:[(0,n.jsx)(ee.content,{content:G?C.content:$(V),currentVersionIndex:V,getDocumentContentById:$,isCurrentVersion:G,isInline:!1,isLoading:P&&!C.content,metadata:I,mode:A,onSaveContent:B,setMetadata:T,status:C.status,suggestions:[],title:C.title}),(0,n.jsx)(o.N,{children:G&&(0,n.jsx)(e2,{artifactKind:C.kind,isToolbarVisible:Z,sendMessage:x,setIsToolbarVisible:J,setMessages:b,status:p,stop:f})})]}),(0,n.jsx)(o.N,{children:!G&&(0,n.jsx)(e3,{currentVersionIndex:V,documents:z,handleVersionChange:K})})]})]})})},(e,t)=>e.status===t.status&&!!i()(e.votes,t.votes)&&e.input===t.input&&!!i()(e.messages,t.messages.length))},87319:(e,t,s)=>{s.d(t,{r:()=>o});var n=s(39485),r=s(30214),a=s(45647),i=s(78672);function o(){let{dataStream:e}=(0,r.u)(),{artifact:t,setArtifact:s,setMetadata:o}=(0,a.ST)(),l=(0,n.useRef)(-1);return(0,n.useEffect)(()=>{if(!(null==e?void 0:e.length))return;let n=e.slice(l.current+1);for(let r of(l.current=e.length-1,n)){let e=i.Rh.find(e=>e.kind===t.kind);(null==e?void 0:e.onStreamPart)&&e.onStreamPart({streamPart:r,setArtifact:s,setMetadata:o}),s(e=>{if(!e)return{...a.ls,status:"streaming"};switch(r.type){case"data-id":return{...e,documentId:r.data,status:"streaming"};case"data-title":return{...e,title:r.data,status:"streaming"};case"data-kind":return{...e,kind:r.data,status:"streaming"};case"data-clear":return{...e,content:"",status:"streaming"};case"data-finish":return{...e,status:"idle"};default:return e}})}},[e,s,o,t]),null}},91639:(e,t,s)=>{s.d(t,{HV:()=>a,KW:()=>o,er:()=>i}),s(56357),s(32621);var n=s(91502),r=s(83415);async function a(e,t){await Promise.resolve(),localStorage.setItem("chat-model",e),t&&localStorage.setItem("chat-provider",t)}async function i(e){let{id:t}=e;try{let e=await (0,r.getLocalMessagesByChatId)({id:t});if(e.length>0){let s=e[0];await (0,n.b4)(t,[s])}return{success:!0}}catch(e){return console.error("Error deleting trailing messages:",e),{success:!1,error:"Failed to delete trailing messages"}}}async function o(e){let{documentId:t}=e,s=await (0,r.si)({id:t});return null!=s?s:[]}},94456:(e,t,s)=>{s.d(t,{e:()=>S,q:()=>I});var n=s(98089),r=s(68693),a=s.n(r),i=s(72153),o=s(39485),l=s(30214),d=s(53047),c=s(66181);o.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(c.Root,{ref:t,className:(0,d.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})}).displayName=c.Root.displayName,o.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(c.Image,{ref:t,className:(0,d.cn)("aspect-square h-full w-full",s),...r})}).displayName=c.Image.displayName,o.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(c.Fallback,{ref:t,className:(0,d.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})}).displayName=c.Fallback.displayName;let u=e=>{let{children:t,className:s,...r}=e;return(0,n.jsx)("div",{className:(0,d.cn)("flex flex-col gap-2 overflow-hidden rounded-lg px-4 py-3 text-foreground text-sm","group-[.is-user]:bg-primary group-[.is-user]:text-primary-foreground","group-[.is-assistant]:bg-secondary group-[.is-assistant]:text-foreground","is-user:dark",s),...r,children:t})};var m=s(59278),p=s(61391),f=s(66087),h=s(70469),g=s(36177),x=s(55928),v=s(23625);let y=e=>{let{className:t,children:s,...r}=e;return(0,n.jsx)("div",{className:(0,d.cn)("flex items-center gap-1",t),...r,children:s})},b=e=>{let{tooltip:t,children:s,label:r,className:a,variant:i="ghost",size:o="sm",...l}=e,c=(0,n.jsxs)(x.$,{className:(0,d.cn)("relative size-9 p-1.5 text-muted-foreground hover:text-foreground",a),size:o,type:"button",variant:i,...l,children:[s,(0,n.jsx)("span",{className:"sr-only",children:r||t})]});return t?(0,n.jsx)(v.Bc,{children:(0,n.jsxs)(v.m_,{children:[(0,n.jsx)(v.k$,{asChild:!0,children:c}),(0,n.jsx)(v.ZI,{children:(0,n.jsx)("p",{children:t})})]})}):c},j=(0,o.memo)(function(e){var t;let{chatId:s,message:r,isLoading:a,setMode:i}=e,[o,l]=(0,g.Cj)();if(a)return null;let d=null==(t=r.parts)?void 0:t.filter(e=>"text"===e.type).map(e=>e.text).join("\n").trim(),c=async()=>{if(!d)return void h.o.error("There's no text to copy!");await l(d),h.o.success("Copied to clipboard!")},u=async()=>{try{let e={id:r.id,chatId:s,role:r.role,parts:r.parts,metadata:r.metadata,exportedAt:new Date().toISOString()},t=[{name:"message-".concat(r.id,".json"),lastModified:new Date,input:JSON.stringify(e,null,2)},{name:"message-".concat(r.id,".md"),lastModified:new Date,input:d||""}],n=await (0,f._6)(t).blob(),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download="message-".concat(r.id,".zip"),a.click(),h.o.success("Message downloaded as ZIP!")}catch(e){console.error("Failed to download message as ZIP:",e),h.o.error("Failed to download message as ZIP")}};return"user"===r.role?(0,n.jsx)(y,{className:"-mr-0.5 justify-end",children:(0,n.jsxs)("div",{className:"relative",children:[i&&(0,n.jsx)(b,{className:"-left-10 absolute top-0 opacity-0 transition-opacity group-hover/message:opacity-100",onClick:()=>i("edit"),tooltip:"Edit",children:(0,n.jsx)(p.vL,{})}),(0,n.jsx)(b,{onClick:c,tooltip:"Copy",children:(0,n.jsx)(p.Td,{})})]})}):(0,n.jsxs)(y,{className:"-ml-0.5",children:[(0,n.jsx)(b,{onClick:c,tooltip:"Copy",children:(0,n.jsx)(p.Td,{})}),(0,n.jsx)(b,{onClick:()=>{try{let e={id:r.id,chatId:s,role:r.role,parts:r.parts,metadata:r.metadata,exportedAt:new Date().toISOString()},t=JSON.stringify(e,null,2),n="data:application/json;charset=utf-8,".concat(encodeURIComponent(t)),a="message-".concat(r.id,".json"),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",a),i.click(),h.o.success("Message downloaded as JSON!")}catch(e){console.error("Failed to download message as JSON:",e),h.o.error("Failed to download message as JSON")}},tooltip:"Download as JSON",children:(0,n.jsx)(p.oS,{})}),(0,n.jsx)(b,{onClick:u,tooltip:"Download JSON and Markdown as ZIP",children:(0,n.jsx)(p.s3,{})})]})},(e,t)=>e.isLoading===t.isLoading);var w=s(91639),k=s(54506);function N(e){let{message:t,setMode:s,setMessages:r,regenerate:a}=e,[i,l]=(0,o.useState)(!1),[c,u]=(0,o.useState)((0,d.JZ)(t)),m=(0,o.useRef)(null),p=(0,o.useCallback)(()=>{m.current&&(m.current.style.height="auto",m.current.style.height="".concat(m.current.scrollHeight+2,"px"))},[]);return(0,o.useEffect)(()=>{m.current&&p()},[p]),(0,n.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,n.jsx)(k.T,{className:"w-full resize-none overflow-hidden rounded-xl bg-transparent text-base! outline-hidden","data-testid":"message-editor",onChange:e=>{u(e.target.value),p()},ref:m,value:c}),(0,n.jsxs)("div",{className:"flex flex-row justify-end gap-2",children:[(0,n.jsx)(x.$,{className:"h-fit px-3 py-2",onClick:()=>{s("view")},variant:"outline",children:"Cancel"}),(0,n.jsx)(x.$,{className:"h-fit px-3 py-2","data-testid":"message-editor-send-button",disabled:i,onClick:async()=>{l(!0),await (0,w.er)({id:t.id}),r(e=>{let s=e.findIndex(e=>e.id===t.id);if(-1!==s){let n={...t,parts:[{type:"text",text:c}]};return[...e.slice(0,s),n]}return e}),s("view"),a()},variant:"default",children:i?"Sending...":"Send"})]})]})}var C=s(66581);let S=(0,o.memo)(e=>{var t,s,r;let{chatId:a,message:c,isLoading:f,setMessages:h,regenerate:g,requiresScrollPadding:x,isReadonly:v,vote:y}=e,[b,w]=(0,o.useState)("view"),k=c.parts.filter(e=>"file"===e.type);return(0,l.u)(),(0,n.jsx)(i.P.div,{animate:{opacity:1},className:"group/message w-full","data-role":c.role,"data-testid":"message-".concat(c.role),initial:{opacity:0},children:(0,n.jsxs)("div",{className:(0,d.cn)("flex w-full items-start gap-2 md:gap-3",{"justify-end":"user"===c.role&&"edit"!==b,"justify-start":"assistant"===c.role}),children:["assistant"===c.role&&(0,n.jsx)("div",{className:"-mt-1 flex size-8 shrink-0 items-center justify-center rounded-full bg-background ring-1 ring-border",children:(0,n.jsx)("div",{className:f?"animate-pulse text-blue-500 drop-shadow-[0_0_2px_rgba(59,130,246,0.5)]":"",children:(0,n.jsx)(p.BZ,{size:14})})}),(0,n.jsxs)("div",{className:(0,d.cn)("flex flex-col",{"gap-2 md:gap-4":null==(t=c.parts)?void 0:t.some(e=>{var t;return"text"===e.type&&(null==(t=e.text)?void 0:t.trim())}),"min-h-96":"assistant"===c.role&&x,"w-full":"assistant"===c.role&&(null==(s=c.parts)?void 0:s.some(e=>{var t;return"text"===e.type&&(null==(t=e.text)?void 0:t.trim())}))||"edit"===b,"max-w-[calc(100%-2.5rem)] sm:max-w-[min(fit-content,80%)]":"user"===c.role&&"edit"!==b}),children:[k.length>0&&(0,n.jsx)("div",{className:"flex flex-row justify-end gap-2","data-testid":"message-attachments",children:k.map(e=>{var t;return(0,n.jsx)(C.q,{attachment:{name:null!=(t=e.filename)?t:"file",contentType:e.mediaType,url:e.url}},e.url)})}),null==(r=c.parts)?void 0:r.map((e,t)=>{let{type:s}=e,r="message-".concat(c.id,"-part-").concat(t);if("text"===s){if("view"===b)return(0,n.jsx)("div",{children:(0,n.jsx)(u,{className:(0,d.cn)({"w-fit break-words rounded-xl px-3 py-2 text-white":"user"===c.role,"bg-transparent px-0 py-0 text-left":"assistant"===c.role}),"data-testid":"message-content",style:"user"===c.role?{backgroundColor:"#006cff"}:void 0,children:(0,n.jsx)(m.Y,{children:(0,d.jZ)(e.text)})})},r);if("edit"===b&&!v)return(0,n.jsxs)("div",{className:"flex w-full flex-row items-start gap-3",children:[(0,n.jsx)("div",{className:"size-8"}),(0,n.jsx)("div",{className:"min-w-0 flex-1",children:(0,n.jsx)(N,{message:c,regenerate:g,setMessages:h,setMode:w},c.id)})]},r)}return null}),"assistant"===c.role&&!v&&(0,n.jsx)(j,{chatId:a,isLoading:f,message:c,setMode:w})]})]})})},(e,t)=>e.isLoading===t.isLoading&&e.isReadonly===t.isReadonly&&!!a()(e.vote,t.vote)&&!!a()(e.message,t.message));function I(){return(0,n.jsxs)(i.P.div,{animate:{opacity:1},className:"flex w-full items-start gap-3",initial:{opacity:0},children:[(0,n.jsx)("div",{className:"-mt-1 flex size-8 shrink-0 items-center justify-center rounded-full bg-background ring-1 ring-border",children:(0,n.jsx)("div",{className:"animate-pulse text-blue-500 drop-shadow-[0_0_2px_rgba(59,130,246,0.5)]",children:(0,n.jsx)(p.BZ,{size:14})})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("div",{className:"h-2 w-32 animate-pulse rounded-full bg-muted-foreground/20"}),(0,n.jsx)("div",{className:"h-2 w-24 animate-pulse rounded-full bg-muted-foreground/20"})]})]})}}}]);